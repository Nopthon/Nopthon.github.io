<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark_colorblind" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://nopthon.github.io/burger.svg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="# Lab 2: Bomb Lab

二进制炸弹 `Bomb` 是一个由多个阶段组成的程序，每个阶段会要求用户在 `stdin` 输入特定字符串。">
<meta property="og:title" content="CSAPP Bomblab Solution">
<meta property="og:description" content="# Lab 2: Bomb Lab

二进制炸弹 `Bomb` 是一个由多个阶段组成的程序，每个阶段会要求用户在 `stdin` 输入特定字符串。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://Nopthon.github.io/post/CSAPP%20Bomblab%20Solution.html">
<meta property="og:image" content="https://nopthon.github.io/burger.svg">
<title>CSAPP Bomblab Solution</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>
<style>pre, code, pre code {tab-size: 4 !important; -moz-tab-size: 4 !important;}</style><style>.markdown-alert{padding:0.5rem 1rem;margin-bottom:1rem;border-left:.25em solid var(--borderColor-default,var(--color-border-default));}.markdown-alert .markdown-alert-title {display:flex;font-weight:var(--base-text-weight-medium,500);align-items:center;line-height:1;}.markdown-alert>:first-child {margin-top:0;}.markdown-alert>:last-child {margin-bottom:0;}</style><style>.markdown-alert.markdown-alert-note {border-left-color:var(--borderColor-accent-emphasis, var(--color-accent-emphasis));background-color:var(--color-accent-subtle);}.markdown-alert.markdown-alert-note .markdown-alert-title {color: var(--fgColor-accent,var(--color-accent-fg));}</style><style>.markdown-alert.markdown-alert-tip {border-left-color:var(--borderColor-success-emphasis, var(--color-success-emphasis));background-color:var(--color-success-subtle);}.markdown-alert.markdown-alert-tip .markdown-alert-title {color: var(--fgColor-success,var(--color-success-fg));}</style>



<body>
    <div id="header">
<h1 class="postTitle">CSAPP Bomblab Solution</h1>
<div class="title-right">
    <a href="https://Nopthon.github.io" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/Nopthon/Nopthon.github.io/issues/5" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>Lab 2: Bomb Lab</h1>
<p>二进制炸弹 <code class="notranslate">Bomb</code> 是一个由多个阶段组成的程序，每个阶段会要求用户在 <code class="notranslate">stdin</code> 输入特定字符串。若输入正确，该阶段即被拆除并进入下一阶段；否则程序将输出"BOOM! ! ! "后终止（即炸弹爆炸）。只有当所有阶段均被拆除后，炸弹才算彻底解除。</p>
<p>Writeup文件有以下的指南：</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p><strong>工具指南</strong>：</p>
<ul>
<li>
<p><strong>gdb</strong>：<br>
GNU调试器，支持单步跟踪/内存检查/断点设置等功能。推荐使用CS:APP官网提供的单页速查表：<br>
<code class="notranslate">http://csapp.cs.cmu.edu/public/students.html</code></p>
<ul>
<li>设置断点可防止错误输入导致的爆炸</li>
<li>通过<code class="notranslate">help</code>/<code class="notranslate">man gdb</code>/<code class="notranslate">info gdb</code>获取帮助文档</li>
</ul>
</li>
<li>
<p><strong>objdump</strong>：</p>
<ul>
<li><code class="notranslate">objdump -t</code>：查看炸弹符号表（含函数/全局变量地址）</li>
<li><code class="notranslate">objdump -d</code>：反汇编全部代码（注意系统调用会显示为晦涩格式，需结合gdb分析）</li>
</ul>
</li>
<li>
<p><strong>strings</strong>：<br>
提取炸弹中的可打印字符串</p>
<p>（AI翻译自<a href="http://csapp.cs.cmu.edu/3e/bomblab.pdf" rel="nofollow">Writeup文件</a>）</p>
</li>
</ul>
</div>
<hr>
<h3>Solution</h3>
<p>我们所需要做的就是通过反汇编找出六组密码，考虑到在线版的炸弹每一次引爆都会扣除分数，当然是  <del>追求无伤clear什么的</del></p>
<div class="markdown-alert markdown-alert-tip"><p class="markdown-alert-title"><svg class="octicon octicon-light-bulb mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>为了锻炼个人阅读 x86-64 汇编代码的能力，我采用的拆弹方案是直接分析反汇编代码，因此下面的操作将很少使用 gdb 工具</p>
</div>
<p>在进行对 <code class="notranslate">bomb</code> 的反编译之前，可以看一看旁边的 <code class="notranslate">bomb.c</code> 文件（这是一个提示作用的文件，展示了原程序 <code class="notranslate">&lt;main&gt;</code> 函数的流程），这个C程序告诉我们 <code class="notranslate">bomb</code> 的运行方式，比如：</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-s1">input</span> <span class="pl-c1">=</span> <span class="pl-en">read_line</span>();				<span class="pl-c">/* Get input                   */</span>
<span class="pl-en">phase_1</span>(<span class="pl-s1">input</span>);						<span class="pl-c">/* Run the phase               */</span>
<span class="pl-en">phase_defused</span>();					<span class="pl-c">/* Drat!  They figured it out!</span>
<span class="pl-c">									 * Let me know how they did it. */</span>
<span class="pl-en">printf</span>(<span class="pl-s">"Phase 1 defused. How about the next one?\n"</span>);</pre></div>
<p>另外最后的注释说明也暗示了总共不只有六个 bomb 需要拆除：</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-c">/* Wow, they got it!  But isn't something... missing?  Perhaps</span>
<span class="pl-c"> * something they overlooked?  Mua ha ha ha ha! */</span></pre></div>
<p><code class="notranslate">❯ objdump bomb -d -j .text</code> 开始拆弹（反编译代码段），可以看到很多标记点，而我们目前需要关注的只有 <code class="notranslate">&lt;main&gt;</code> 部分和 <code class="notranslate">&lt;phase&gt;</code> 部分。其中 <code class="notranslate">main</code> 部分从 <code class="notranslate">bomb.c</code> 文件中就能理解意思（初始化炸弹，检测输入判断炸弹是否爆炸等等），所以直接看六个阶段的汇编代码即可：</p>
<p>（有趣的是有一个 <code class="notranslate">&lt;secret_phase&gt;</code> 标记点，这对应了 <code class="notranslate">bomb.c</code> 中暗示的隐藏炸弹）</p>
<blockquote>
<p>（题解中没有明显区分诸如 <code class="notranslate">%rbx</code> 和 <code class="notranslate">(%rbx)</code> 的写法，可能有一定混淆）</p>
</blockquote>
<blockquote>
<p>网页对 Tab 的渲染不是很好，在 Github Issues 页面或许会有更好的阅读体验</p>
</blockquote>
<hr>
<h2>Phase 1</h2>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">000000000400ee0 &lt;phase_1&gt;:</span>
<span class="pl-en">  400ee0:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">					# 栈上分配 8byte 的空间（起对齐作用）</span>
<span class="pl-en">  400ee4:	be </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x402400</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">				# 将 </span><span class="pl-c1">0x402400</span><span class="pl-en"> 这个地址加载到 %</span><span class="pl-v">esi</span><span class="pl-en"> 中</span>
<span class="pl-en">  400ee9:	e8 4a </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401338</span><span class="pl-en"> &lt;strings_not_equal&gt;	# 调用执行 strings_not_equal 函数</span>
<span class="pl-en">  400eee:	</span><span class="pl-c1">85</span><span class="pl-en"> c0                	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# 计算 %</span><span class="pl-v">eax</span><span class="pl-en"> &amp; %</span><span class="pl-v">eax</span><span class="pl-en">，不保存结果，目的是改变标志位</span>
<span class="pl-en">  400ef0:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400ef7 &lt;phase_1</span><span class="pl-s1">+</span><span class="pl-c1">0x17</span><span class="pl-en">&gt;		# 当标志位 ZF==</span><span class="pl-c1">1</span><span class="pl-en"> 时跳转到 400ef7 （表示拆弹成功）</span>
<span class="pl-en">  400ef2:	e8 </span><span class="pl-c1">43</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!!!</span>
<span class="pl-en">  400ef7:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">					# 释放栈空间</span>
<span class="pl-en">  400efb:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">									# 结束子程序</span>
<span class="pl-en">  </span>
<span class="pl-c1">0000000000401338</span><span class="pl-en"> &lt;strings_not_equal&gt;: # 比较 %</span><span class="pl-v">rdi</span><span class="pl-en"> 与 %</span><span class="pl-v">rsi</span><span class="pl-en"> 指向的字符串是否不相等，不相等则返回 </span><span class="pl-c1">1</span><span class="pl-en">，反之返回 </span><span class="pl-c1">0</span><span class="pl-en">，此处反编译代码略</span></pre></div>
<p><code class="notranslate">strings_not_equal</code> 比较的是输入 <code class="notranslate">%rdi</code> 和 <code class="notranslate">%rsi</code> 指向的字符串是否不相同，而两个相同的输入可以触发 <code class="notranslate">je</code> 的跳转避免炸弹爆炸</p>
<p>（标志位就是条件码）</p>
<p><code class="notranslate">400ee4</code> 处 <code class="notranslate">%esi</code> 被赋值为 <code class="notranslate">$0x402400</code> 的字符串，在gdb环境中对这个地址查看存储的字符串内容：</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">❯ gdb ./bomb
GNU gdb (Ubuntu 12.1-0ubuntu1~22.04.2) 12.1
(gdb) x/s 0x402400
0x402400:	<span class="pl-s"><span class="pl-pds">"</span>Border relations with Canada have never been better.<span class="pl-pds">"</span></span></pre></div>
<p>得到了第一个答案：<code class="notranslate">Border relations with Canada have never been better.</code></p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>gdb 的 <code class="notranslate">x</code> 命令（e<strong>X</strong>amine memory）用于查看内存中的数据</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">x/[N][F][U] <span class="pl-k">&lt;</span>address<span class="pl-k">&gt;</span></pre></div>
<ul>
<li><strong><code class="notranslate">N</code></strong>：显示的单位数量（可选，默认为1）。</li>
<li><strong><code class="notranslate">F</code></strong>：显示格式（如十六进制、十进制、字符串等）。</li>
<li><strong><code class="notranslate">U</code></strong>：单位大小（如字节、字、双字等）。</li>
<li><strong><code class="notranslate">&lt;address&gt;</code></strong>：内存地址（可以是寄存器、变量名或直接地址）。</li>
</ul>
</div>
<h2>Phase 2</h2>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">0000000000400efc &lt;phase_2&gt;:</span>
<span class="pl-en">  400efc:	</span><span class="pl-c1">55</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbp</span>
<span class="pl-en">  400efd:	</span><span class="pl-c1">53</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbx</span><span class="pl-en">							# 被调用者保存寄存器</span>
<span class="pl-en">  400efe:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">28</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x28</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">					# 开辟栈空间</span>
<span class="pl-en">  400f02:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e6             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  400f05:	e8 </span><span class="pl-c1">52</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40145c &lt;read_six_numbers&gt;	# 表明密码是六个（整）数</span>
<span class="pl-en">  400f0a:	</span><span class="pl-c1">83</span><span class="pl-en"> 3c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en">          	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">) 					# 根据 (%</span><span class="pl-v">rsp</span><span class="pl-en">) </span><span class="pl-s1">-</span><span class="pl-en"> </span><span class="pl-c1">1</span><span class="pl-en"> 改变标志位</span>
<span class="pl-en">  400f0e:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">20</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400f30 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x34</span><span class="pl-en">&gt; 		# 如果相等就跳转，否则下一步 BOOM!</span>
<span class="pl-en">  400f10:	e8 </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400f15:	eb </span><span class="pl-c1">19</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400f30 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x34</span><span class="pl-en">&gt;		# 无条件跳转</span>
<span class="pl-en">  400f17:	8b </span><span class="pl-c1">43</span><span class="pl-en"> fc             	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-s1">-</span><span class="pl-c1">0x4</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 从 400f3a 跳转；将 (%</span><span class="pl-v">rbx</span><span class="pl-s1">-</span><span class="pl-c1">4</span><span class="pl-en">) 处数据存入 %</span><span class="pl-v">eax</span>
<span class="pl-en">  400f1a:	</span><span class="pl-c1">01</span><span class="pl-en"> c0                	</span><span class="pl-k">add</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> </span><span class="pl-s1">*</span><span class="pl-en">= </span><span class="pl-c1">2</span>
<span class="pl-en">  400f1c:	</span><span class="pl-c1">39</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en">                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)					# 根据(%</span><span class="pl-v">rbx</span><span class="pl-en">) </span><span class="pl-s1">-</span><span class="pl-en"> %</span><span class="pl-v">eax</span><span class="pl-en"> 设置标志位</span>
<span class="pl-en">  400f1e:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400f25 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;		# 如果相等就跳转，否则下一步 BOOM!</span>
<span class="pl-en">  400f20:	e8 </span><span class="pl-c1">15</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt; 		# BOOM!</span>
<span class="pl-en">  400f25:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c3 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">					# 从 400f1e 跳转；%</span><span class="pl-v">rbx</span><span class="pl-s1">+</span><span class="pl-en">=</span><span class="pl-c1">4</span>
<span class="pl-en">  400f29:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">39</span><span class="pl-en"> eb             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">rbp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">					# 根据 %</span><span class="pl-v">rbx</span><span class="pl-en"> </span><span class="pl-s1">-</span><span class="pl-en"> %</span><span class="pl-v">rbp</span><span class="pl-en"> 改变标志位</span>
<span class="pl-en">  400f2c:	</span><span class="pl-c1">75</span><span class="pl-en"> e9                	</span><span class="pl-k">jne</span><span class="pl-en">    400f17 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x1b</span><span class="pl-en">&gt;		# 如果不相等就跳转回上一次跳转点（一次循环）</span>
<span class="pl-en">  400f2e:	eb 0c                	</span><span class="pl-k">jmp</span><span class="pl-en">    400f3c &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x40</span><span class="pl-en">&gt;		# 无条件跳转，表示拆弹成功</span>
<span class="pl-en">  400f30:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 5c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x4</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">				# 从 400f0e 跳转；%</span><span class="pl-v">rbx</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-s1">+</span><span class="pl-c1">4</span>
<span class="pl-en">  400f35:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 6c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbp</span><span class="pl-en">				# %</span><span class="pl-v">rbp</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">0x18</span>
<span class="pl-en">  400f3a:	eb db                	</span><span class="pl-k">jmp</span><span class="pl-en">    400f17 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x1b</span><span class="pl-en">&gt;		# 无条件跳转</span>
<span class="pl-en">  400f3c:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">28</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x28</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  400f40:	5b                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbx</span>
<span class="pl-en">  400f41:	5d                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbp</span>
<span class="pl-en">  400f42:	c3                   	</span><span class="pl-k">ret</span>

<span class="pl-en">000000000040145c &lt;read_six_numbers&gt;: # 读取六个数</span>
<span class="pl-en">... ...</span>
<span class="pl-en">  </span><span class="pl-c1">401480</span><span class="pl-en">:	be c3 </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4025c3</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span>
<span class="pl-en">... ...</span>
<span class="pl-en"># (gdb) x/s </span><span class="pl-c1">0x4025c3</span>
<span class="pl-en"># </span><span class="pl-c1">0x4025c3</span><span class="pl-en">:	</span><span class="pl-s">"%d %d %d %d %d %d"</span>
<span class="pl-en"># 说明读取的是整数，数字之间用空格分隔</span></pre></div>
<p>首先看最开始的这一部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  400f0a:	</span><span class="pl-c1">83</span><span class="pl-en"> 3c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en">          	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">) 					# 根据 (%</span><span class="pl-v">rsp</span><span class="pl-en">) </span><span class="pl-s1">-</span><span class="pl-en"> </span><span class="pl-c1">1</span><span class="pl-en"> 改变标志位</span>
<span class="pl-en">  400f0e:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">20</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400f30 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x34</span><span class="pl-en">&gt; 		# 如果相等就跳转，否则下一步 BOOM!</span>
<span class="pl-en">  400f10:	e8 </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span></pre></div>
<p>很明显，第一个数字要输入 <code class="notranslate">1</code> ，否则炸弹爆炸</p>
<p>然后看这一部分</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  400f30:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 5c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x4</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">				# 从 400f0e 跳转；%</span><span class="pl-v">rbx</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-s1">+</span><span class="pl-c1">4</span>
<span class="pl-en">  400f35:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 6c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbp</span><span class="pl-en">				# %</span><span class="pl-v">rbp</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">0x18</span>
<span class="pl-en">  400f3a:	eb db                	</span><span class="pl-k">jmp</span><span class="pl-en">    400f17 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x1b</span><span class="pl-en">&gt;		# 无条件跳转</span></pre></div>
<p>这里程序设定了 <code class="notranslate">%rbx</code> 存储第二个数字<strong>的地址</strong>，<code class="notranslate">%rbp</code> 为第六个数字之后<strong>的地址</strong>（<code class="notranslate">0x18</code> = 24 = 6 int），接着跳转到一个循环部分</p>
<p>结合后面的程序可以看得出来，这段代码可以类比 <code class="notranslate">for (int i = 1; i &lt; 6; i++)</code> 的前两个参数设置</p>
<p>接着是这一部分，看上去是个有限循环</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  400f17:	8b </span><span class="pl-c1">43</span><span class="pl-en"> fc             	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-s1">-</span><span class="pl-c1">0x4</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 从 400f3a 跳转；将 (%</span><span class="pl-v">rbx</span><span class="pl-s1">-</span><span class="pl-c1">4</span><span class="pl-en">) 处数据存入 %</span><span class="pl-v">eax</span>
<span class="pl-en">  400f1a:	</span><span class="pl-c1">01</span><span class="pl-en"> c0                	</span><span class="pl-k">add</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> </span><span class="pl-s1">*</span><span class="pl-en">= </span><span class="pl-c1">2</span>
<span class="pl-en">  400f1c:	</span><span class="pl-c1">39</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en">                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)					# 根据(%</span><span class="pl-v">rbx</span><span class="pl-en">) </span><span class="pl-s1">-</span><span class="pl-en"> %</span><span class="pl-v">eax</span><span class="pl-en"> 设置标志位</span>
<span class="pl-en">  400f1e:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400f25 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;		# 如果相等就跳转，否则下一步 BOOM!</span>
<span class="pl-en">  400f20:	e8 </span><span class="pl-c1">15</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt; 		# BOOM!</span>
<span class="pl-en">  400f25:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c3 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">					# 从 400f1e 跳转；%</span><span class="pl-v">rbx</span><span class="pl-s1">+</span><span class="pl-en">=</span><span class="pl-c1">4</span>
<span class="pl-en">  400f29:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">39</span><span class="pl-en"> eb             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">rbp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">					# 根据 %</span><span class="pl-v">rbx</span><span class="pl-en"> </span><span class="pl-s1">-</span><span class="pl-en"> %</span><span class="pl-v">rbp</span><span class="pl-en"> 改变标志位</span>
<span class="pl-en">  400f2c:	</span><span class="pl-c1">75</span><span class="pl-en"> e9                	</span><span class="pl-k">jne</span><span class="pl-en">    400f17 &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x1b</span><span class="pl-en">&gt;		# 如果不相等就跳转回上一次跳转点（一次循环）</span>
<span class="pl-en">  400f2e:	eb 0c                	</span><span class="pl-k">jmp</span><span class="pl-en">    400f3c &lt;phase_2</span><span class="pl-s1">+</span><span class="pl-c1">0x40</span><span class="pl-en">&gt;		# 无条件跳转，表示拆弹成功</span></pre></div>
<p>这里直接写出对应的 C 语言代码了，其中规定 <code class="notranslate">%rsp</code> 开始的六个数字组成数组 <code class="notranslate">stack[6]</code> ，<code class="notranslate">%rbx + 4</code> 表示 <code class="notranslate">i++</code></p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-k">for</span> (<span class="pl-smi">int</span> <span class="pl-s1">i</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>; <span class="pl-s1">i</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">6</span>; <span class="pl-s1">i</span><span class="pl-c1">++</span>){
	<span class="pl-smi">int</span> <span class="pl-c1">EAX</span> <span class="pl-c1">=</span> <span class="pl-s1">stack</span>[<span class="pl-s1">i</span><span class="pl-c1">-</span><span class="pl-c1">1</span>];												<span class="pl-c">// EAX 为 “上一个数字”</span>
	<span class="pl-c1">EAX</span> *= <span class="pl-c1">2</span>;															<span class="pl-c">// EAX 为 “上一个数字” 的两倍</span>
	<span class="pl-k">if</span>(<span class="pl-s1">stack</span>[<span class="pl-s1">i</span>] <span class="pl-c1">-</span> <span class="pl-c1">EAX</span> <span class="pl-c1">==</span> <span class="pl-c1">0</span>){											<span class="pl-c">// ZF == 1 ?</span>
	<span class="pl-k">continue</span>;															<span class="pl-c">// 跳过引爆炸弹的函数</span>
    }
    <span class="pl-en">explode_bomb</span>();
}</pre></div>
<p>由此可见，接下来的五个数字都要求每个数字是上一个数字的两倍，因此第二个答案是 <code class="notranslate">1 2 4 8 16 32</code></p>
<h2>Phase 3</h2>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">0000000000400f43 &lt;phase_3&gt;:</span>
<span class="pl-en">  400f43:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">					# 开辟栈空间</span>
<span class="pl-en">  400f47:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 4c </span><span class="pl-c1">24</span><span class="pl-en"> 0c       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span><span class="pl-en">				# %</span><span class="pl-v">rcx</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">12</span><span class="pl-en">（地址计算）</span>
<span class="pl-en">  400f4c:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span><span class="pl-en">				# %</span><span class="pl-v">rdx</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span><span class="pl-en">（地址计算）</span>
<span class="pl-en">  400f51:	be cf </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4025cf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">				# (gdb) x/s </span><span class="pl-c1">0x4025cf</span><span class="pl-en">: </span><span class="pl-s">"%d %d"</span><span class="pl-s1">,</span><span class="pl-en"> 赋值给 %</span><span class="pl-v">esi</span>
<span class="pl-en">  400f56:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">0</span>
<span class="pl-en">  400f5b:	e8 </span><span class="pl-c1">90</span><span class="pl-en"> fc ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400bf0 &lt;__isoc99_sscanf@plt&gt;	# 调用标准库函数 sscanf，读取的内容参见 </span><span class="pl-c1">0x4025cf</span>
<span class="pl-en">  400f60:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# 比较 %</span><span class="pl-v">eax</span><span class="pl-en"> ~ </span><span class="pl-c1">1</span>
<span class="pl-en">  400f63:	7f </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jg</span><span class="pl-en">     400f6a &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x27</span><span class="pl-en">&gt;		# 有符号 “大于” 成立则跳过引爆代码，否则 BOOM!</span>
<span class="pl-en">  400f65:	e8 d0 </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400f6a:	</span><span class="pl-c1">83</span><span class="pl-en"> 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en"> </span><span class="pl-c1">07</span><span class="pl-en">       	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0x7</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)				# 比较 (%</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span><span class="pl-en">) ~ </span><span class="pl-c1">7</span>
<span class="pl-en">  400f6f:	</span><span class="pl-c1">77</span><span class="pl-en"> 3c                	</span><span class="pl-k">ja</span><span class="pl-en">     400fad &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x6a</span><span class="pl-en">&gt;		# 无符号 “大于” 成立则跳转至引爆代码，否则继续向下运行</span>
<span class="pl-en">  </span>
<span class="pl-en">  400f71:	8b </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span>
<span class="pl-en">  400f75:	ff </span><span class="pl-c1">24</span><span class="pl-en"> c5 </span><span class="pl-c1">70</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-s1">*</span><span class="pl-c1">0x402470</span><span class="pl-en">(</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">8</span><span class="pl-en">)			# 这里是间接跳转中的跳转表跳转，是 switch 语句的实现</span>
<span class="pl-en">  400f7c:	b8 cf </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xcf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">207</span>
<span class="pl-en">  400f81:	eb 3b                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f83:	b8 c3 </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2c3</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">707</span>
<span class="pl-en">  400f88:	eb </span><span class="pl-c1">34</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f8a:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x100</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">256</span>
<span class="pl-en">  400f8f:	eb 2d                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f91:	b8 </span><span class="pl-c1">85</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x185</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">389</span>
<span class="pl-en">  400f96:	eb </span><span class="pl-c1">26</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f98:	b8 ce </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xce</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">206</span>
<span class="pl-en">  400f9d:	eb 1f                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f9f:	b8 aa </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2aa</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">682</span>
<span class="pl-en">  400fa4:	eb </span><span class="pl-c1">18</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400fa6:	b8 </span><span class="pl-c1">47</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x147</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">327</span>
<span class="pl-en">  400fab:	eb </span><span class="pl-c1">11</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400fad:	e8 </span><span class="pl-c1">88</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400fb2:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">0</span>
<span class="pl-en">  400fb7:	eb </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400fb9:	b8 </span><span class="pl-c1">37</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x137</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">311</span>
<span class="pl-en">  </span>
<span class="pl-en">  400fbe:	3b </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> 0c          	</span><span class="pl-k">cmp</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 比较 %</span><span class="pl-v">eax</span><span class="pl-en"> ~ (%</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">12</span><span class="pl-en">)</span>
<span class="pl-en">  400fc2:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400fc9 &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x86</span><span class="pl-en">&gt;		# 若 “相等” 成立则成功拆弹</span>
<span class="pl-en">  400fc4:	e8 </span><span class="pl-c1">71</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400fc9:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  400fcd:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">    </span></pre></div>
<p>先看第一部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  400f43:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">					# 开辟栈空间</span>
<span class="pl-en">  400f47:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 4c </span><span class="pl-c1">24</span><span class="pl-en"> 0c       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span><span class="pl-en">				# %</span><span class="pl-v">rcx</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">12</span>
<span class="pl-en">  400f4c:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span><span class="pl-en">				# %</span><span class="pl-v">rdx</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span>
<span class="pl-en">  400f51:	be cf </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4025cf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">				# (gdb) x/s </span><span class="pl-c1">0x4025cf</span><span class="pl-en">: </span><span class="pl-s">"%d %d"</span><span class="pl-s1">,</span><span class="pl-en"> 赋值给 %</span><span class="pl-v">esi</span>
<span class="pl-en">  400f56:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">0</span>
<span class="pl-en">  400f5b:	e8 </span><span class="pl-c1">90</span><span class="pl-en"> fc ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400bf0 &lt;__isoc99_sscanf@plt&gt;	# 调用标准库函数 sscanf，读取的内容参见 </span><span class="pl-c1">0x4025cf</span>
<span class="pl-en">  400f60:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# 比较 %</span><span class="pl-v">eax</span><span class="pl-en"> ~ </span><span class="pl-c1">1</span>
<span class="pl-en">  400f63:	7f </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jg</span><span class="pl-en">     400f6a &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x27</span><span class="pl-en">&gt;		# 有符号 “大于” 成立则跳过引爆代码，否则 BOOM!</span>
<span class="pl-en">  400f65:	e8 d0 </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400f6a:	</span><span class="pl-c1">83</span><span class="pl-en"> 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en"> </span><span class="pl-c1">07</span><span class="pl-en">       	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0x7</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)				# 比较 (%</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span><span class="pl-en">) ~ </span><span class="pl-c1">7</span>
<span class="pl-en">  400f6f:	</span><span class="pl-c1">77</span><span class="pl-en"> 3c                	</span><span class="pl-k">ja</span><span class="pl-en">     400fad &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x6a</span><span class="pl-en">&gt;		# 无符号 “大于” 成立则跳转至引爆代码，否则继续向下运行</span></pre></div>
<p><code class="notranslate">mov $0x4025cf,%esi</code>  这一句可以知道需要读取的是两个整数</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p><code class="notranslate">sscanf</code> 的函数原型中，第一个参数 <code class="notranslate">%rdi</code> 是输入字符串的指针，第二个参数是格式字符串的指针，这里也就是 <code class="notranslate">0x4025cf</code> 的内容； <code class="notranslate">%rdx</code> 与 <code class="notranslate">%rcx</code> 分别存储第一个、第二个结果的地址（之后的参数依次 <code class="notranslate">r8</code> 和 <code class="notranslate">r9</code> 存储，接着会使用栈传递）</p>
<p>因此两个 <code class="notranslate">lea</code> 语句看似没有作用，实则表示了两个整数的地址</p>
</div>
<p><code class="notranslate">%eax</code> 根据约定被设定为 <code class="notranslate">sscanf</code> 的返回值，<code class="notranslate">400f60 ~ 400f65</code> 的判断跳转说明 “如果 <code class="notranslate">%eax</code> 的值，也就是输入的整数个数没达到 2 个，直接引爆炸弹”</p>
<p>接下来 <code class="notranslate">cmpl $0x7,0x8(%rsp)</code> 及其后面的跳转表明：第一个数（也就是 <code class="notranslate">0x8(%rsp)</code> , 也就是 <code class="notranslate">%rdx</code> 的对应值）必须 <code class="notranslate">&lt;= 7</code> ，否则炸弹爆炸（因为是无符号比较，所以负数输入都不正确）</p>
<p>总结：需要输入两个数；第一个数不能超过 <code class="notranslate">7</code></p>
<p>再看第二部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  400f71:	8b </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span>
<span class="pl-en">  400f75:	ff </span><span class="pl-c1">24</span><span class="pl-en"> c5 </span><span class="pl-c1">70</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-s1">*</span><span class="pl-c1">0x402470</span><span class="pl-en">(</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">8</span><span class="pl-en">)			# 这里是间接跳转中的跳转表跳转，是 switch 语句的实现</span>
<span class="pl-en">  400f7c:	b8 cf </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xcf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">207</span>
<span class="pl-en">  400f81:	eb 3b                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f83:	b8 c3 </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2c3</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">707</span>
<span class="pl-en">  400f88:	eb </span><span class="pl-c1">34</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f8a:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x100</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">256</span>
<span class="pl-en">  400f8f:	eb 2d                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f91:	b8 </span><span class="pl-c1">85</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x185</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">389</span>
<span class="pl-en">  400f96:	eb </span><span class="pl-c1">26</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f98:	b8 ce </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xce</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">206</span>
<span class="pl-en">  400f9d:	eb 1f                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400f9f:	b8 aa </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2aa</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">682</span>
<span class="pl-en">  400fa4:	eb </span><span class="pl-c1">18</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400fa6:	b8 </span><span class="pl-c1">47</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x147</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">327</span>
<span class="pl-en">  400fab:	eb </span><span class="pl-c1">11</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400fad:	e8 </span><span class="pl-c1">88</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400fb2:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">0</span>
<span class="pl-en">  400fb7:	eb </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    400fbe &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x7b</span><span class="pl-en">&gt;</span>
<span class="pl-en">  400fb9:	b8 </span><span class="pl-c1">37</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x137</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">311</span></pre></div>
<p>第一步 <code class="notranslate">mov 0x8(%rsp),%eax</code> 把第一个输入的数字复制到了 <code class="notranslate">%eax</code></p>
<p>接下来关键的一步 <code class="notranslate">jmp *0x402470(,%rax,8)</code> 是跳转表跳转。使用 <code class="notranslate">gdb x</code> 查看跳转表内容</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">(gdb) x/8gx 0x402470	<span class="pl-c"><span class="pl-c">#</span> 以双字为单位，显示 8 个连续的十六进制数值（考虑到 %rdx 值 &lt;= 7，显示 8 个值足够）</span>
0x402470:	0x0000000000400f7c	0x0000000000400fb9
0x402480:	0x0000000000400f83	0x0000000000400f8a
0x402490:	0x0000000000400f91	0x0000000000400f98
0x4024a0:	0x0000000000400f9f	0x0000000000400fa6</pre></div>
<p><code class="notranslate">*0x402470(,%rax,8)</code> 表示内存间接寻址，可以理解为以 <code class="notranslate">0x402470</code> 为基址，加上 <code class="notranslate">%rax</code> 个 <code class="notranslate">64bit</code> 的偏移量，比如 <code class="notranslate">%rax</code> 为 <code class="notranslate">1</code> 时，就跳转到 <code class="notranslate">400fb9</code></p>
<p>不妨就以输入的第一个数字为 <code class="notranslate">1</code> 为例，此时 <code class="notranslate">%eax</code> 被赋值为 <code class="notranslate">311</code></p>
<p>最后看第三部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  400fbe:	3b </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> 0c          	</span><span class="pl-k">cmp</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 比较 %</span><span class="pl-v">eax</span><span class="pl-en"> ~ (%</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">12</span><span class="pl-en">)</span>
<span class="pl-en">  400fc2:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     400fc9 &lt;phase_3</span><span class="pl-s1">+</span><span class="pl-c1">0x86</span><span class="pl-en">&gt;		# 若 “相等” 成立则成功拆弹</span>
<span class="pl-en">  400fc4:	e8 </span><span class="pl-c1">71</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;		# BOOM!</span>
<span class="pl-en">  400fc9:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  400fcd:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">    </span></pre></div>
<p>简单来说就是：如果上一部分设定的 <code class="notranslate">%eax</code> 与第二个输入相等就解除炸弹，否则引爆。比如 <code class="notranslate">%rdx</code> 值为 <code class="notranslate">1</code> 时，必须有 <code class="notranslate">%rcx</code> 值为 <code class="notranslate">311</code> 。也就是说跳转表决定了共计 8 个 <code class="notranslate">%rdx</code> 输入对应的唯一的 <code class="notranslate">%rcx</code> ：</p>
<markdown-accessiblity-table><table role="table">
    <tbody><tr>
        <td>%rdx</td>
        <td>0</td>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td>4</td>
        <td>5</td>
        <td>6</td>
        <td>7</td>
    </tr>
    <tr>
        <td>%rcx</td>
        <td>207</td>
        <td>311</td>
        <td>707</td>
        <td>256</td>
        <td>389</td>
        <td>206</td>
        <td>682</td>
        <td>327</td>
    </tr>
</tbody></table></markdown-accessiblity-table>
<p>在上面的组合中随意选择一项作为答案就可以拆除第三个炸弹，比如 <code class="notranslate">2 707</code></p>
<h2>Phase 4</h2>
<p>（减少了注释量）</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">000000000040100c &lt;phase_4&gt;:</span>
<span class="pl-en">  40100c:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401010</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 4c </span><span class="pl-c1">24</span><span class="pl-en"> 0c       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span>
<span class="pl-en">  </span><span class="pl-c1">401015</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span>
<span class="pl-en">  40101a:	be cf </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4025cf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span>
<span class="pl-en">  40101f:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401024</span><span class="pl-en">:	e8 c7 fb ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400bf0 &lt;__isoc99_sscanf@plt&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401029</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">02</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40102c:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">07</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401035</span><span class="pl-en"> &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;</span>
<span class="pl-en">  40102e:	</span><span class="pl-c1">83</span><span class="pl-en"> 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en"> 0e       	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0xe</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span>
<span class="pl-en">  </span><span class="pl-c1">401033</span><span class="pl-en">:	</span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jbe</span><span class="pl-en">    40103a &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x2e</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401035</span><span class="pl-en">:	e8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  </span>
<span class="pl-en">  40103a:	ba 0e </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xe</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  40103f:	be </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span>
<span class="pl-en">  </span><span class="pl-c1">401044</span><span class="pl-en">:	8b 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span>
<span class="pl-en">  </span><span class="pl-c1">401048</span><span class="pl-en">:	e8 </span><span class="pl-c1">81</span><span class="pl-en"> ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400fce &lt;func4&gt;</span>
<span class="pl-en">  40104d:	</span><span class="pl-c1">85</span><span class="pl-en"> c0                	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40104f:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">07</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401058</span><span class="pl-en"> &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x4c</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401051</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> 7c </span><span class="pl-c1">24</span><span class="pl-en"> 0c </span><span class="pl-c1">00</span><span class="pl-en">       	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span>
<span class="pl-en">  </span><span class="pl-c1">401056</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     40105d &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x51</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401058</span><span class="pl-en">:	e8 dd </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  40105d:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401061</span><span class="pl-en">:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">    </span></pre></div>
<p>先看这部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  40100c:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401010</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 4c </span><span class="pl-c1">24</span><span class="pl-en"> 0c       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span>
<span class="pl-en">  </span><span class="pl-c1">401015</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span>
<span class="pl-en">  40101a:	be cf </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4025cf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">				# (gdb) x/s </span><span class="pl-c1">0x4025cf</span><span class="pl-en">: </span><span class="pl-s">"%d %d"</span><span class="pl-s1">,</span><span class="pl-en"> 赋值给 %</span><span class="pl-v">esi</span>
<span class="pl-en">  40101f:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401024</span><span class="pl-en">:	e8 c7 fb ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400bf0 &lt;__isoc99_sscanf@plt&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401029</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">02</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40102c:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">07</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401035</span><span class="pl-en"> &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;</span>
<span class="pl-en">  40102e:	</span><span class="pl-c1">83</span><span class="pl-en"> 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en"> 0e       	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0xe</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span>
<span class="pl-en">  </span><span class="pl-c1">401033</span><span class="pl-en">:	</span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jbe</span><span class="pl-en">    40103a &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x2e</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401035</span><span class="pl-en">:	e8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span></pre></div>
<p>这一部分和上一阶段几乎一样：读取两个整数；如果输入的整数个数不为 <code class="notranslate">2</code> 则爆炸，否则让第一个数字与 <code class="notranslate">14</code> 比较，如果第一个数字 <code class="notranslate">&lt;= 14</code> 则跳转至下一部分（因为是无符号比较，所以负数输入都不正确），否则炸弹爆炸</p>
<p>于是我们知道了答案是两个数字，并且第一个数字是不超过 <code class="notranslate">14</code> 的非负数</p>
<p>再看另一部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  40103a:	ba 0e </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xe</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  40103f:	be </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span>
<span class="pl-en">  </span><span class="pl-c1">401044</span><span class="pl-en">:	8b 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span>
<span class="pl-en">  </span><span class="pl-c1">401048</span><span class="pl-en">:	e8 </span><span class="pl-c1">81</span><span class="pl-en"> ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400fce &lt;func4&gt;			# 调用一个神秘函数</span>
<span class="pl-en">  40104d:	</span><span class="pl-c1">85</span><span class="pl-en"> c0                	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 只有返回值 %</span><span class="pl-v">eax</span><span class="pl-en"> == </span><span class="pl-c1">0</span><span class="pl-en"> 时使 ZF 置 </span><span class="pl-c1">1</span><span class="pl-en">，和下一条指令结合使用</span>
<span class="pl-en">  40104f:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">07</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401058</span><span class="pl-en"> &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x4c</span><span class="pl-en">&gt;	# ZF == </span><span class="pl-c1">0</span><span class="pl-en"> 时跳转爆炸，也就是说 func4 的返回值必须是 </span><span class="pl-c1">0</span>
<span class="pl-en">  </span><span class="pl-c1">401051</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> 7c </span><span class="pl-c1">24</span><span class="pl-en"> 0c </span><span class="pl-c1">00</span><span class="pl-en">       	cmpl</span>   <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)			# 第二个数与 </span><span class="pl-c1">0</span><span class="pl-en"> 比较</span>
<span class="pl-en">  </span><span class="pl-c1">401056</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     40105d &lt;phase_4</span><span class="pl-s1">+</span><span class="pl-c1">0x51</span><span class="pl-en">&gt;	# 第二个数如果等于 </span><span class="pl-c1">0</span><span class="pl-en"> ，则解除炸弹，否则引爆</span>
<span class="pl-en">  </span><span class="pl-c1">401058</span><span class="pl-en">:	e8 dd </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  40105d:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401061</span><span class="pl-en">:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">  </span></pre></div>
<p>将 <code class="notranslate">%esi</code> 与 <code class="notranslate">%edx</code> 分别设置为 <code class="notranslate">0</code> 和 <code class="notranslate">14</code>，<code class="notranslate">%edi</code> 设置为第一个输入，然后调用 <code class="notranslate">func4</code> 函数，当且仅当返回值为 <code class="notranslate">0</code> 并且第二个输入的数为 <code class="notranslate">0</code> 时解除炸弹</p>
<p>现在来看 <code class="notranslate">func4</code> ：（<code class="notranslate">%rdx</code> 与 <code class="notranslate">%rcx</code> 分别储存了两个输入的数的地址而不是值；<code class="notranslate">%edi</code> 储存了第一个数的值）</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">0000000000400fce &lt;func4&gt;:</span>
<span class="pl-en">  400fce:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">				# 开辟了一个 </span><span class="pl-k">int</span><span class="pl-en"> 大小的栈空间</span>
<span class="pl-en">  400fd2:	</span><span class="pl-c1">89</span><span class="pl-en"> d0                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">edx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> = %</span><span class="pl-v">edx</span>
<span class="pl-en">  400fd4:	</span><span class="pl-c1">29</span><span class="pl-en"> f0                	</span><span class="pl-k">sub</span><span class="pl-en">    %</span><span class="pl-v">esi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> </span><span class="pl-s1">-</span><span class="pl-en">= %</span><span class="pl-v">esi</span><span class="pl-en"> </span>
<span class="pl-en">  400fd6:	</span><span class="pl-c1">89</span><span class="pl-en"> c1                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">				# %</span><span class="pl-v">ecx</span><span class="pl-en"> = %</span><span class="pl-v">eax</span>
<span class="pl-en">  400fd8:	c1 e9 1f             	</span><span class="pl-k">shr</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1f</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">				# %</span><span class="pl-v">ecx</span><span class="pl-en"> 逻辑右移 </span><span class="pl-c1">31</span><span class="pl-en"> 位，也就是取符号位</span>
<span class="pl-en">  400fdb:	</span><span class="pl-c1">01</span><span class="pl-en"> c8                	</span><span class="pl-k">add</span><span class="pl-en">    %</span><span class="pl-v">ecx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en">= %</span><span class="pl-v">ecx</span>
<span class="pl-en">  400fdd:	d1 f8                	</span><span class="pl-k">sar</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-en">						# %</span><span class="pl-v">eax</span><span class="pl-en"> 算术右移 </span><span class="pl-c1">1</span><span class="pl-en"> 位，也就是 %</span><span class="pl-v">eax</span><span class="pl-en"> // </span><span class="pl-c1">2</span>
<span class="pl-en">  400fdf:	8d 0c </span><span class="pl-c1">30</span><span class="pl-en">             	</span><span class="pl-k">lea</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">		# %</span><span class="pl-v">ecx</span><span class="pl-en"> = %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rsi</span><span class="pl-en"> （地址计算）</span>
<span class="pl-en">  </span>
<span class="pl-en">  400fe2:	</span><span class="pl-c1">39</span><span class="pl-en"> f9                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">edi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">				# 比较 %</span><span class="pl-v">ecx</span><span class="pl-en"> ~ %</span><span class="pl-v">edi</span>
<span class="pl-en">  400fe4:	7e 0c                	</span><span class="pl-k">jle</span><span class="pl-en">    400ff2 &lt;func4</span><span class="pl-s1">+</span><span class="pl-c1">0x24</span><span class="pl-en">&gt;		# 如果 &lt;= 成立就跳转至 400ff2，否则继续</span>
<span class="pl-en">  # 在 %</span><span class="pl-v">ecx</span><span class="pl-en"> &gt; %</span><span class="pl-v">edi</span><span class="pl-en"> （值比较）情况下</span>
<span class="pl-en">  400fe6:	8d </span><span class="pl-c1">51</span><span class="pl-en"> ff             	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-s1">-</span><span class="pl-c1">0x1</span><span class="pl-en">(%</span><span class="pl-v">rcx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">			# %</span><span class="pl-v">edx</span><span class="pl-en"> = %</span><span class="pl-v">rcx</span><span class="pl-en"> </span><span class="pl-s1">-</span><span class="pl-en"> </span><span class="pl-c1">1</span><span class="pl-en">（地址计算）</span>
<span class="pl-en">  400fe9:	e8 e0 ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400fce &lt;func4&gt;			# 递归调用自身！</span>
<span class="pl-en">  400fee:	</span><span class="pl-c1">01</span><span class="pl-en"> c0                	</span><span class="pl-k">add</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> </span><span class="pl-s1">*</span><span class="pl-en">= </span><span class="pl-c1">2</span><span class="pl-en">，也就是返回值乘以 </span><span class="pl-c1">2</span>
<span class="pl-en">  400ff0:	eb </span><span class="pl-c1">15</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401007</span><span class="pl-en"> &lt;func4</span><span class="pl-s1">+</span><span class="pl-c1">0x39</span><span class="pl-en">&gt;		# 跳转结束函数调用</span>
<span class="pl-en">  # 在 %</span><span class="pl-v">ecx</span><span class="pl-en"> &lt;= %</span><span class="pl-v">edi</span><span class="pl-en"> 情况下：</span>
<span class="pl-en">  400ff2:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">0</span>
<span class="pl-en">  400ff7:	</span><span class="pl-c1">39</span><span class="pl-en"> f9                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">edi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">				# 比较 %</span><span class="pl-v">ecx</span><span class="pl-en"> ~ %</span><span class="pl-v">edi</span>
<span class="pl-en">  400ff9:	7d 0c                	</span><span class="pl-k">jge</span><span class="pl-en">    </span><span class="pl-c1">401007</span><span class="pl-en"> &lt;func4</span><span class="pl-s1">+</span><span class="pl-c1">0x39</span><span class="pl-en">&gt;		# 如果 &gt;= 成立跳转结束函数调用</span>
<span class="pl-en">  # 在 %</span><span class="pl-v">ecx</span><span class="pl-en"> &lt; %</span><span class="pl-v">edi</span><span class="pl-en"> 情况下：</span>
<span class="pl-en">  400ffb:	8d </span><span class="pl-c1">71</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x1</span><span class="pl-en">(%</span><span class="pl-v">rcx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">			# %</span><span class="pl-v">esi</span><span class="pl-en"> = %</span><span class="pl-v">rcx</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">1</span><span class="pl-en">（地址计算）</span>
<span class="pl-en">  400ffe:	e8 cb ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400fce &lt;func4&gt;			# 递归调用自身！</span>
<span class="pl-en">  </span><span class="pl-c1">401003</span><span class="pl-en">:	8d </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en">          	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x1</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">	# %</span><span class="pl-v">eax</span><span class="pl-en"> = </span><span class="pl-c1">2</span><span class="pl-en"> </span><span class="pl-s1">*</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">1</span><span class="pl-en"> （地址计算）</span>
<span class="pl-en">  </span><span class="pl-c1">401007</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">				# 释放栈空间</span>
<span class="pl-en">  40100b:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">    							# 退出函数，返回值是 %</span><span class="pl-v">eax</span></pre></div>
<p>这是一个递归函数，我们尝试用 C 语言去描述上面的行为：</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-c">// scanf("%d %d",&amp;x,&amp;y); </span>
<span class="pl-c">// 前面的一些操作可以理解为 edx = &amp;x; ecx = &amp;y; edi = x;</span>
<span class="pl-smi">int</span> <span class="pl-en">func4</span>(<span class="pl-smi">int</span> <span class="pl-s1">edi</span>, <span class="pl-smi">int</span> <span class="pl-s1">esi</span>, <span class="pl-smi">int</span> <span class="pl-s1">edx</span>){								<span class="pl-c">// 更加易读的：func4(int target, int left, int right)</span>
	<span class="pl-s1">eax</span> <span class="pl-c1">=</span> <span class="pl-s1">edi</span> <span class="pl-c1">-</span> <span class="pl-s1">esi</span>; <span class="pl-s1">ecx</span> <span class="pl-c1">=</span> <span class="pl-s1">eax</span>;
    <span class="pl-k">if</span>(<span class="pl-s1">ecx</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">0</span>) <span class="pl-s1">eax</span><span class="pl-c1">++</span>;												<span class="pl-c">// 原代码是通过获取符号位的方式进行负数的二分中点值调整</span>
    <span class="pl-s1">ecx</span> <span class="pl-c1">=</span> (<span class="pl-s1">eax</span> &gt;&gt; <span class="pl-c1">1</span>) <span class="pl-c1">+</span> <span class="pl-s1">esi</span>;
    	<span class="pl-c">// 到这里的操作可以总结成：mid = l + (r - l) // 2，也就是二分查找计算中点值 </span>
    <span class="pl-k">if</span>(<span class="pl-s1">ecx</span> &lt;= <span class="pl-s1">edi</span>){													<span class="pl-c">// 400fe4: jle 400ff2 &lt;func4+0x24&gt;</span>
        <span class="pl-k">if</span> (<span class="pl-s1">ecx</span> &gt;= <span class="pl-s1">edi</span>) <span class="pl-k">return</span> <span class="pl-c1">0</span>;									<span class="pl-c">// 400ff9: jge 401007 &lt;func4+0x39&gt;</span>
        <span class="pl-k">return</span> <span class="pl-c1">2</span> <span class="pl-c1">*</span> <span class="pl-en">func4</span>(<span class="pl-s1">edi</span>, <span class="pl-s1">ecx</span><span class="pl-c1">+</span><span class="pl-c1">1</span>, <span class="pl-s1">edx</span>) <span class="pl-c1">+</span> <span class="pl-c1">1</span>;
    }
    <span class="pl-k">return</span> <span class="pl-c1">2</span> <span class="pl-c1">*</span> <span class="pl-en">func4</span>(<span class="pl-s1">edi</span>, <span class="pl-s1">esi</span>, <span class="pl-s1">ecx</span><span class="pl-c1">-</span><span class="pl-c1">1</span>);
}</pre></div>
<p>一个典型的二分查找，只有找到这个目标值 <code class="notranslate">edi = x</code> 才会返回 <code class="notranslate">0</code> 值（另外那个负数偏移调整没有必要，因为输入的整数已经限制为了非负数）</p>
<p>所以我的第一个输入必须可以直接在二分查找的时候被精准定位：</p>
<p><code class="notranslate">14 // 2 = 7</code> <code class="notranslate">7 // 2 = 3</code> <code class="notranslate">3 // 2 = 1</code> <code class="notranslate">1 // 2 = 0</code> 这四次二分查找时出现的中间值 <code class="notranslate">mid</code> 就是所有成立的第一个输入</p>
<p>也就是说 <code class="notranslate">7 0</code> <code class="notranslate">3 0</code> <code class="notranslate">1 0</code> <code class="notranslate">0 0</code> 都是正确答案</p>
<h2>Phase 5</h2>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-c1">0000000000401062</span><span class="pl-en"> &lt;phase_5&gt;:</span>
<span class="pl-en">  # Part </span><span class="pl-c1">1</span>
<span class="pl-en">  </span><span class="pl-c1">401062</span><span class="pl-en">:	</span><span class="pl-c1">53</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbx</span>
<span class="pl-en">  </span><span class="pl-c1">401063</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">20</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x20</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401067</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> fb             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span>
<span class="pl-en">  40106a:	</span><span class="pl-c1">64</span><span class="pl-en"> </span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">28</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">fs</span><span class="pl-en">:</span><span class="pl-c1">0x28</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  </span><span class="pl-c1">401071</span><span class="pl-en">:	</span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span>
<span class="pl-en">  </span><span class="pl-c1">401073</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)			# 将 %</span><span class="pl-v">rax</span><span class="pl-en"> 的值存入栈地址 %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> 处</span>
<span class="pl-en">  </span><span class="pl-c1">401078</span><span class="pl-en">:	</span><span class="pl-c1">31</span><span class="pl-en"> c0                	</span><span class="pl-k">xor</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 利用异或操作清零 %</span><span class="pl-v">eax</span>
<span class="pl-en">  40107a:	e8 9c </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40131b &lt;string_length&gt;	# 返回字符串的长度</span>
<span class="pl-en">  40107f:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">06</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 返回值与 </span><span class="pl-c1">6</span><span class="pl-en"> 比较</span>
<span class="pl-en">  </span><span class="pl-c1">401082</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> 4e                	</span><span class="pl-k">je</span><span class="pl-en">     4010d2 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x70</span><span class="pl-en">&gt;	# 如果相等则跳转，否则爆炸</span>
<span class="pl-en">  </span><span class="pl-c1">401084</span><span class="pl-en">:	e8 b1 </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;	# BOOM! </span>
<span class="pl-en">  </span><span class="pl-c1">401089</span><span class="pl-en">:	eb </span><span class="pl-c1">47</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    4010d2 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x70</span><span class="pl-en">&gt;</span>
<span class="pl-en">  # Part </span><span class="pl-c1">2</span>
<span class="pl-en">  40108b:	0f b6 0c </span><span class="pl-c1">03</span><span class="pl-en">          	movzbl (%</span><span class="pl-v">rbx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">		# %</span><span class="pl-v">ecx</span><span class="pl-en"> = ((%</span><span class="pl-v">rbx</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> 处的 1byte 值) 零扩展至 </span><span class="pl-c1">32</span><span class="pl-en"> 位)</span>
<span class="pl-en">  40108f:	</span><span class="pl-c1">88</span><span class="pl-en"> 0c </span><span class="pl-c1">24</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">cl</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)				# %</span><span class="pl-v">rcx</span><span class="pl-en"> 的低八位 存入 %</span><span class="pl-v">rsp</span><span class="pl-en"> 指向的地址</span>
<span class="pl-en">  </span><span class="pl-c1">401092</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">14</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span><span class="pl-en">				# %</span><span class="pl-v">rsp</span><span class="pl-en"> 地址处的内容传入 %</span><span class="pl-v">rdx</span>
<span class="pl-en">  </span><span class="pl-c1">401096</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> e2 0f             	</span><span class="pl-k">and</span>    <span class="pl-c1">$</span><span class="pl-c1">0xf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">				# %</span><span class="pl-v">edx</span><span class="pl-en"> 与 0b1111 按位与，结果存入 %</span><span class="pl-v">edx</span><span class="pl-en">（也就是保留低四位值）</span>
<span class="pl-en">  </span><span class="pl-c1">401099</span><span class="pl-en">:	0f b6 </span><span class="pl-c1">92</span><span class="pl-en"> b0 </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	movzbl </span><span class="pl-c1">0x4024b0</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">		# %</span><span class="pl-v">edx</span><span class="pl-en"> = ((</span><span class="pl-c1">0x4024b0</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rdx</span><span class="pl-en"> 处的 1byte 值) 零扩展至 </span><span class="pl-c1">32</span><span class="pl-en"> 位)</span>
<span class="pl-en">  4010a0:	</span><span class="pl-c1">88</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">dl</span><span class="pl-s1">,</span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)	# %</span><span class="pl-v">rdx</span><span class="pl-en"> 的低八位 存入地址 %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">0x10</span><span class="pl-en"> 处</span>
<span class="pl-en">  4010a4:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">01</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">				# %</span><span class="pl-v">rax</span><span class="pl-s1">++</span>
<span class="pl-en">  4010a8:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">06</span><span class="pl-en">          	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">				# %</span><span class="pl-v">rax</span><span class="pl-en"> 与 </span><span class="pl-c1">6</span><span class="pl-en"> 比较</span>
<span class="pl-en">  4010ac:	</span><span class="pl-c1">75</span><span class="pl-en"> dd                	</span><span class="pl-k">jne</span><span class="pl-en">    40108b &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;	# 如果不相等，回到 40108b</span>
<span class="pl-en">  # Part </span><span class="pl-c1">3</span>
<span class="pl-en">  4010ae:	c6 </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">16</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	movb</span>   <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-c1">0x16</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)			# </span><span class="pl-s1">*</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">+</span><span class="pl-c1">22</span><span class="pl-en">) = </span><span class="pl-c1">0x00</span><span class="pl-en">，更直观的来说：</span><span class="pl-v">rsp</span><span class="pl-s1">[</span><span class="pl-c1">22</span><span class="pl-s1">]</span><span class="pl-en"> = </span><span class="pl-c1">0</span><span class="pl-c">;</span>
<span class="pl-en">  4010b3:	be 5e </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x40245e</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">			# (gdb) x/s </span><span class="pl-c1">0x40245e</span><span class="pl-en">: </span><span class="pl-s">"flyers"</span>
<span class="pl-en">  4010b8:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span><span class="pl-en">			# %</span><span class="pl-v">rdi</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">16</span><span class="pl-en">（地址计算）</span>
<span class="pl-en">  4010bd:	e8 </span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401338</span><span class="pl-en"> &lt;strings_not_equal&gt;	# 比较两个字符串 %</span><span class="pl-v">rdi</span><span class="pl-en"> 与 %</span><span class="pl-v">rsi</span><span class="pl-en"> 是否不相等，不相等返回 </span><span class="pl-c1">1</span>
<span class="pl-en">  4010c2:	</span><span class="pl-c1">85</span><span class="pl-en"> c0                	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 这一部分和 Phase </span><span class="pl-c1">1</span><span class="pl-en"> 相同的操作</span>
<span class="pl-en">  4010c4:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">13</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4010d9 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x77</span><span class="pl-en">&gt;	# 两个字符串相等才会跳转，否则炸弹爆炸</span>
<span class="pl-en">  4010c6:	e8 6f </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;	# BOOM!</span>
<span class="pl-en">  4010cb:	0f 1f </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	nopl   </span><span class="pl-c1">0x0</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)			# </span><span class="pl-c1">5</span><span class="pl-en"> 字节长度的 </span><span class="pl-k">NOP</span><span class="pl-en"> 操作</span>
<span class="pl-en">  4010d0:	eb </span><span class="pl-c1">07</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    4010d9 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x77</span><span class="pl-en">&gt;	# 跳转</span>
<span class="pl-en">  4010d2:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 我也不知道这两行有什么用</span>
<span class="pl-en">  4010d7:	eb b2                	</span><span class="pl-k">jmp</span><span class="pl-en">    40108b &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;	# 0_0</span>
<span class="pl-en">  # Part </span><span class="pl-c1">4</span>
<span class="pl-en">  4010d9:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4010de:	</span><span class="pl-c1">64</span><span class="pl-en"> </span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">33</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">28</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	</span><span class="pl-k">xor</span><span class="pl-en">    %</span><span class="pl-v">fs</span><span class="pl-en">:</span><span class="pl-c1">0x28</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4010e5:	</span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span>
<span class="pl-en">  4010e7:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4010ee &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x8c</span><span class="pl-en">&gt;</span>
<span class="pl-en">  4010e9:	e8 </span><span class="pl-c1">42</span><span class="pl-en"> fa ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400b30 &lt;__stack_chk_fail@plt&gt;</span>
<span class="pl-en">  4010ee:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">20</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x20</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  4010f2:	5b                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4010f3:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">    </span>
</pre></div>
<p>程序中有两处 <code class="notranslate">00 00</code> 有分隔作用，只要考虑 <code class="notranslate">401073 ~ 4010de</code> 的内容即可，其他的部分是 Canary 栈保护机制的体现，防攻击用的，无需深挖</p>
<p>先看这一部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">1</span>
<span class="pl-en">  </span><span class="pl-c1">401073</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)			# 将 %</span><span class="pl-v">rax</span><span class="pl-en"> 的值存入栈地址 %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> 处</span>
<span class="pl-en">  </span><span class="pl-c1">401078</span><span class="pl-en">:	</span><span class="pl-c1">31</span><span class="pl-en"> c0                	</span><span class="pl-k">xor</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 利用异或操作清零 %</span><span class="pl-v">eax</span>
<span class="pl-en">  40107a:	e8 9c </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40131b &lt;string_length&gt;	# 返回字符串的长度</span>
<span class="pl-en">  40107f:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">06</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 返回值与 </span><span class="pl-c1">6</span><span class="pl-en"> 比较</span>
<span class="pl-en">  </span><span class="pl-c1">401082</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> 4e                	</span><span class="pl-k">je</span><span class="pl-en">     4010d2 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x70</span><span class="pl-en">&gt;	# 如果相等则跳转，否则爆炸</span>
<span class="pl-en">  </span><span class="pl-c1">401084</span><span class="pl-en">:	e8 b1 </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;	# BOOM! </span>
<span class="pl-en">  </span><span class="pl-c1">401089</span><span class="pl-en">:	eb </span><span class="pl-c1">47</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    4010d2 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x70</span><span class="pl-en">&gt;</span></pre></div>
<p>要求是输入一个长度为 <code class="notranslate">6</code> 的字符串，否则炸弹爆炸</p>
<p>接下来的一段可能不是很好理解，我们不妨先往后看：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">3</span>
<span class="pl-en">  4010ae:	c6 </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">16</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	movb</span>   <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-c1">0x16</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)			# </span><span class="pl-s1">*</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">+</span><span class="pl-c1">22</span><span class="pl-en">) = </span><span class="pl-c1">0x00</span><span class="pl-en">，更直观的来说：</span><span class="pl-v">rsp</span><span class="pl-s1">[</span><span class="pl-c1">22</span><span class="pl-s1">]</span><span class="pl-en"> = </span><span class="pl-c1">0</span><span class="pl-c">;</span>
<span class="pl-en">  4010b3:	be 5e </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x40245e</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">			# (gdb) x/s </span><span class="pl-c1">0x40245e</span><span class="pl-en">: </span><span class="pl-s">"flyers"</span>
<span class="pl-en">  4010b8:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span><span class="pl-en">			# %</span><span class="pl-v">rdi</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">16</span><span class="pl-en">（地址计算）</span>
<span class="pl-en">  4010bd:	e8 </span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401338</span><span class="pl-en"> &lt;strings_not_equal&gt;	# 比较两个字符串 %</span><span class="pl-v">rdi</span><span class="pl-en"> 与 %</span><span class="pl-v">rsi</span><span class="pl-en"> 是否不相等，不相等返回 </span><span class="pl-c1">1</span>
<span class="pl-en">  4010c2:	</span><span class="pl-c1">85</span><span class="pl-en"> c0                	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 这一部分和 Phase </span><span class="pl-c1">1</span><span class="pl-en"> 相同的操作</span>
<span class="pl-en">  4010c4:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">13</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4010d9 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x77</span><span class="pl-en">&gt;	# 两个字符串相等才会跳转，否则炸弹爆炸</span>
<span class="pl-en">  4010c6:	e8 6f </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;	# BOOM!</span>
<span class="pl-en">  4010cb:	0f 1f </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	nopl   </span><span class="pl-c1">0x0</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)			# </span><span class="pl-c1">5</span><span class="pl-en"> 字节长度的 </span><span class="pl-k">NOP</span><span class="pl-en"> 操作</span>
<span class="pl-en">  4010d0:	eb </span><span class="pl-c1">07</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    4010d9 &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x77</span><span class="pl-en">&gt;	# 跳转</span>
<span class="pl-en">  4010d2:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">				# 我也不知道这两行有什么用</span>
<span class="pl-en">  4010d7:	eb b2                	</span><span class="pl-k">jmp</span><span class="pl-en">    40108b &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;	# 0_0</span></pre></div>
<p>有了 Phase 1 的经验我们可以看出来，这部分代码是将 <code class="notranslate">%rdi</code> 设置为输入的六位字符串的起始位置（<code class="notranslate">4010b8</code>，结合前面的 <code class="notranslate">movb</code> 指令可以看得出来），为字符串添加一个 <code class="notranslate">\0</code> （<code class="notranslate">4010ae</code>），然后将这个字符串和 <code class="notranslate">0x40245e</code> 存储的字符串 <code class="notranslate">flyers</code> 进行比较，如果相同则拆弹成功。似乎和 Phase 1 没有区别</p>
<p>回头看之前的部分，这一部分大概率会对原始输入的字符串进行修改（否则就和 Phase 1 一模一样了）</p>
<p>（注释部分进行了更加明显的修改，没错我用 AI 修正了一下）</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">2</span>
<span class="pl-en">  40108b:	0f b6 0c </span><span class="pl-c1">03</span><span class="pl-en">          	movzbl (%</span><span class="pl-v">rbx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">		# 从 %</span><span class="pl-v">rbx</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> 地址读取 1byte，零扩展至 </span><span class="pl-c1">32</span><span class="pl-en"> 位存入 %</span><span class="pl-v">ecx</span>
<span class="pl-en">  40108f:	</span><span class="pl-c1">88</span><span class="pl-en"> 0c </span><span class="pl-c1">24</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">cl</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)				# 将 %</span><span class="pl-v">cl</span><span class="pl-en">（%</span><span class="pl-v">ecx</span><span class="pl-en"> 的低 </span><span class="pl-c1">8</span><span class="pl-en"> 位）存入栈顶 %</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401092</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">14</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span><span class="pl-en">				# 从栈顶 %</span><span class="pl-v">rsp</span><span class="pl-en"> 读取 8byte 到 %</span><span class="pl-v">rdx</span><span class="pl-en">，实际只用到低 1byte</span>
<span class="pl-en">  </span><span class="pl-c1">401096</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> e2 0f             	</span><span class="pl-k">and</span>    <span class="pl-c1">$</span><span class="pl-c1">0xf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">				# 保留 %</span><span class="pl-v">edx</span><span class="pl-en"> 的低 </span><span class="pl-c1">4</span><span class="pl-en"> 位，其余清零</span>
<span class="pl-en">  </span><span class="pl-c1">401099</span><span class="pl-en">:	0f b6 </span><span class="pl-c1">92</span><span class="pl-en"> b0 </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	movzbl </span><span class="pl-c1">0x4024b0</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">		# 从地址 </span><span class="pl-c1">0x4024b0</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rdx</span><span class="pl-en"> 读取 1byte，零扩展至 </span><span class="pl-c1">32</span><span class="pl-en"> 位</span>
<span class="pl-en">  4010a0:	</span><span class="pl-c1">88</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">dl</span><span class="pl-s1">,</span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)	# 将 %</span><span class="pl-v">dl</span><span class="pl-en">（%</span><span class="pl-v">edx</span><span class="pl-en"> 的低 </span><span class="pl-c1">8</span><span class="pl-en"> 位）存入 %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">16</span>
<span class="pl-en">  4010a4:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">01</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">				# %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en">= </span><span class="pl-c1">1</span><span class="pl-en">（循环计数器递增）</span>
<span class="pl-en">  4010a8:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">06</span><span class="pl-en">          	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">				# 比较 %</span><span class="pl-v">rax</span><span class="pl-en"> ~ </span><span class="pl-c1">6</span><span class="pl-en">（检查是否循环 </span><span class="pl-c1">6</span><span class="pl-en"> 次）</span>
<span class="pl-en">  4010ac:	</span><span class="pl-c1">75</span><span class="pl-en"> dd                	</span><span class="pl-k">jne</span><span class="pl-en">    40108b &lt;phase_5</span><span class="pl-s1">+</span><span class="pl-c1">0x29</span><span class="pl-en">&gt;	# 若未完成 </span><span class="pl-c1">6</span><span class="pl-en"> 次循环，跳回 40108b</span></pre></div>
<p>最后三行可以看得出来这部分内容进行了 6 次循环操作，对应了长度为 6 的输入字符串，大概率是对每一个字符进行了某种映射变换</p>
<p>不妨看一看 <code class="notranslate">0x4024b0</code> 处存储了什么内容：</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">(gdb) x 0x4024b0
0x4024b0 <span class="pl-k">&lt;</span>array.<span class="pl-k">3449&gt;</span>:	<span class="pl-s"><span class="pl-pds">"</span>maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?<span class="pl-pds">"</span></span></pre></div>
<p>后面那一串应该不用管，关键是前面的 <code class="notranslate">maduiersnfotvbyl</code> ，这样一串无序的字符串很像是一种映射表（<code class="notranslate">flyers</code> 这几个字母在这里都能找到）</p>
<p>也就是说，正确的输入（六位字符串）在经过映射之后会转化为 <code class="notranslate">flyers</code> ，或许会有一种很简单的假设：</p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>input</th>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
<th>e</th>
<th>f</th>
<th>g</th>
<th>h</th>
<th>i</th>
<th>j</th>
<th>k</th>
<th>l</th>
<th>m</th>
<th>n</th>
<th>o</th>
<th>p</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>(wrong)</strong> output</td>
<td>m</td>
<td>a</td>
<td>d</td>
<td>u</td>
<td>i</td>
<td>e</td>
<td>r</td>
<td>s</td>
<td>n</td>
<td>f</td>
<td>o</td>
<td>t</td>
<td>v</td>
<td>b</td>
<td>y</td>
<td>l</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p>当然事实不是这样，我们发现：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  40108b:	0f b6 0c </span><span class="pl-c1">03</span><span class="pl-en">          	movzbl (%</span><span class="pl-v">rbx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span><span class="pl-en">		# 从 %</span><span class="pl-v">rbx</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> 地址读取 1byte，零扩展至 </span><span class="pl-c1">32</span><span class="pl-en"> 位存入 %</span><span class="pl-v">ecx</span>
<span class="pl-en">  40108f:	</span><span class="pl-c1">88</span><span class="pl-en"> 0c </span><span class="pl-c1">24</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">cl</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)				# 将 %</span><span class="pl-v">cl</span><span class="pl-en">（%</span><span class="pl-v">ecx</span><span class="pl-en"> 的低 </span><span class="pl-c1">8</span><span class="pl-en"> 位）存入栈顶 %</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401092</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">14</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span><span class="pl-en">				# 从栈顶 %</span><span class="pl-v">rsp</span><span class="pl-en"> 读取 8byte 到 %</span><span class="pl-v">rdx</span><span class="pl-en">，实际只用到低 1byte</span>
<span class="pl-en">  </span><span class="pl-c1">401096</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> e2 0f             	</span><span class="pl-k">and</span>    <span class="pl-c1">$</span><span class="pl-c1">0xf</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">				# 保留 %</span><span class="pl-v">edx</span><span class="pl-en"> 的低 </span><span class="pl-c1">4</span><span class="pl-en"> 位，其余清零</span></pre></div>
<p>每个字符（作为 ASCII 形式）最终仅仅读取了最低的四位，也就是说只有最后四位是有用的</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  </span><span class="pl-c1">401099</span><span class="pl-en">:	0f b6 </span><span class="pl-c1">92</span><span class="pl-en"> b0 </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	movzbl </span><span class="pl-c1">0x4024b0</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">		# 从地址 </span><span class="pl-c1">0x4024b0</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rdx</span><span class="pl-en"> 读取 1byte，零扩展至 </span><span class="pl-c1">32</span><span class="pl-en"> 位</span>
<span class="pl-en">  4010a0:	</span><span class="pl-c1">88</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">dl</span><span class="pl-s1">,</span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)	# 将 %</span><span class="pl-v">dl</span><span class="pl-en">（%</span><span class="pl-v">edx</span><span class="pl-en"> 的低 </span><span class="pl-c1">8</span><span class="pl-en"> 位）存入 %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">16</span></pre></div>
<p>接下来这四位二进制内容 <code class="notranslate">%rdx</code> 作为偏移值加在了 <code class="notranslate">0x402400</code> 的地址处，新的 <code class="notranslate">%rdx</code> 又被转移到了 <code class="notranslate">%rsp + %rax + 16</code> （这个位置在之后用于检验字符串相等）</p>
<p>也就是说：字符串的每个字符对应的 ASCII 值的最低四位作为索引 <code class="notranslate">%edx</code> 映射 <code class="notranslate">maduiersnfotvbyl</code> （恰好是 16 位）的内容</p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th>input</th>
<th>0000</th>
<th>0001</th>
<th>0010</th>
<th>0011</th>
<th>0100</th>
<th>0101</th>
<th>0110</th>
<th>0111</th>
<th>1000</th>
<th>1001</th>
<th>1010</th>
<th>1011</th>
<th>1100</th>
<th>1101</th>
<th>1110</th>
<th>1111</th>
</tr>
</thead>
<tbody>
<tr>
<td>output</td>
<td>m</td>
<td>a</td>
<td>d</td>
<td>u</td>
<td>i</td>
<td>e</td>
<td>r</td>
<td>s</td>
<td>n</td>
<td>f</td>
<td>o</td>
<td>t</td>
<td>v</td>
<td>b</td>
<td>y</td>
<td>l</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p>所以正确答案的六个字符的 ASCII 码低四位应该依次为 <code class="notranslate">1001</code> <code class="notranslate">1111</code> <code class="notranslate">1110</code> <code class="notranslate">0101</code> <code class="notranslate">0110</code> <code class="notranslate">0111</code> ，比如 <code class="notranslate">ionefg</code> <code class="notranslate">yonuvw</code></p>
<h2>Phase 6</h2>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">00000000004010f4 &lt;phase_6&gt;:</span>
<span class="pl-en">  # Part </span><span class="pl-c1">1</span>
<span class="pl-en">  4010f4:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">56</span><span class="pl-en">                	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">r14</span>
<span class="pl-en">  4010f6:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">55</span><span class="pl-en">                	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">r13</span>
<span class="pl-en">  4010f8:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en">                	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">r12</span>
<span class="pl-en">  4010fa:	</span><span class="pl-c1">55</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbp</span>
<span class="pl-en">  4010fb:	</span><span class="pl-c1">53</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4010fc:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">50</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x50</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401100</span><span class="pl-en">:	</span><span class="pl-c1">49</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e5             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r13</span>
<span class="pl-en">  </span><span class="pl-c1">401103</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e6             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401106</span><span class="pl-en">:	e8 </span><span class="pl-c1">51</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40145c &lt;read_six_numbers&gt;</span>
<span class="pl-en">  40110b:	</span><span class="pl-c1">49</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e6             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r14</span>
<span class="pl-en">  40110e:	</span><span class="pl-c1">41</span><span class="pl-en"> bc </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">    	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r12d</span>
<span class="pl-en">  # Part </span><span class="pl-c1">2</span>
<span class="pl-en">  </span><span class="pl-c1">401114</span><span class="pl-en">:	4c </span><span class="pl-c1">89</span><span class="pl-en"> ed             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">r13</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbp</span>
<span class="pl-en">  </span><span class="pl-c1">401117</span><span class="pl-en">:	</span><span class="pl-c1">41</span><span class="pl-en"> 8b </span><span class="pl-c1">45</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x0</span><span class="pl-en">(%</span><span class="pl-v">r13</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40111b:	</span><span class="pl-c1">83</span><span class="pl-en"> e8 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40111e:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">05</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x5</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401121</span><span class="pl-en">:	</span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jbe</span><span class="pl-en">    </span><span class="pl-c1">401128</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x34</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401123</span><span class="pl-en">:	e8 </span><span class="pl-c1">12</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401128</span><span class="pl-en">:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">01</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r12d</span>
<span class="pl-en">  40112c:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> fc </span><span class="pl-c1">06</span><span class="pl-en">          	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r12d</span>
<span class="pl-en">  </span><span class="pl-c1">401130</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">21</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     </span><span class="pl-c1">401153</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x5f</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401132</span><span class="pl-en">:	</span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e3             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">r12d</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebx</span>
<span class="pl-en">  </span><span class="pl-c1">401135</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">63</span><span class="pl-en"> c3             	movslq %</span><span class="pl-v">ebx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  </span><span class="pl-c1">401138</span><span class="pl-en">:	8b </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">84</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">4</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40113b:	</span><span class="pl-c1">39</span><span class="pl-en"> </span><span class="pl-c1">45</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-c1">0x0</span><span class="pl-en">(%</span><span class="pl-v">rbp</span><span class="pl-en">)</span>
<span class="pl-en">  40113e:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401145</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x51</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401140</span><span class="pl-en">:	e8 f5 </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401145</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> c3 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebx</span>
<span class="pl-en">  </span><span class="pl-c1">401148</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> fb </span><span class="pl-c1">05</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x5</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebx</span>
<span class="pl-en">  40114b:	7e e8                	</span><span class="pl-k">jle</span><span class="pl-en">    </span><span class="pl-c1">401135</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x41</span><span class="pl-en">&gt;</span>
<span class="pl-en">  40114d:	</span><span class="pl-c1">49</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c5 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r13</span>
<span class="pl-en">  </span><span class="pl-c1">401151</span><span class="pl-en">:	eb c1                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401114</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x20</span><span class="pl-en">&gt;</span>
<span class="pl-en">  # Part </span><span class="pl-c1">3</span>
<span class="pl-en">  </span><span class="pl-c1">401153</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401158</span><span class="pl-en">:	4c </span><span class="pl-c1">89</span><span class="pl-en"> f0             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">r14</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  40115b:	b9 </span><span class="pl-c1">07</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x7</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span>
<span class="pl-en">  </span><span class="pl-c1">401160</span><span class="pl-en">:	</span><span class="pl-c1">89</span><span class="pl-en"> ca                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">ecx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401162</span><span class="pl-en">:	2b </span><span class="pl-c1">10</span><span class="pl-en">                	</span><span class="pl-k">sub</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401164</span><span class="pl-en">:	</span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">edx</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-en">)</span>
<span class="pl-en">  </span><span class="pl-c1">401166</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  40116a:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">39</span><span class="pl-en"> f0             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  40116d:	</span><span class="pl-c1">75</span><span class="pl-en"> f1                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401160</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x6c</span><span class="pl-en">&gt;</span>
<span class="pl-en">  # Part </span><span class="pl-c1">4</span>
<span class="pl-en">  40116f:	be </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span>
<span class="pl-en">  </span><span class="pl-c1">401174</span><span class="pl-en">:	eb </span><span class="pl-c1">21</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401197</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xa3</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401176</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">52</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span>
<span class="pl-en">  40117a:	</span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40117d:	</span><span class="pl-c1">39</span><span class="pl-en"> c8                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">ecx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40117f:	</span><span class="pl-c1">75</span><span class="pl-en"> f5                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401176</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x82</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401181</span><span class="pl-en">:	eb </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401188</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x94</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401183</span><span class="pl-en">:	ba d0 </span><span class="pl-c1">32</span><span class="pl-en"> </span><span class="pl-c1">60</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6032d0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401188</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">20</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdx</span><span class="pl-s1">,</span><span class="pl-c1">0x20</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-c1">2</span><span class="pl-en">)</span>
<span class="pl-en">  40118d:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c6 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401191</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> fe </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401195</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">14</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4011ab &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xb7</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401197</span><span class="pl-en">:	8b 0c </span><span class="pl-c1">34</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span>
<span class="pl-en">  40119a:	</span><span class="pl-c1">83</span><span class="pl-en"> f9 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span>
<span class="pl-en">  40119d:	7e e4                	</span><span class="pl-k">jle</span><span class="pl-en">    </span><span class="pl-c1">401183</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x8f</span><span class="pl-en">&gt;</span>
<span class="pl-en">  40119f:	b8 </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  4011a4:	ba d0 </span><span class="pl-c1">32</span><span class="pl-en"> </span><span class="pl-c1">60</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6032d0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  4011a9:	eb cb                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401176</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x82</span><span class="pl-en">&gt;</span>
<span class="pl-en">  # Part </span><span class="pl-c1">5</span>
<span class="pl-en">  4011ab:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b 5c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">20</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x20</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011b0:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">28</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x28</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4011b5:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">50</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x50</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  4011ba:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> d9             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rbx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span>
<span class="pl-en">  4011bd:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">10</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span>
<span class="pl-en">  4011c0:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">51</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdx</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rcx</span><span class="pl-en">)</span>
<span class="pl-en">  4011c4:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4011c8:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">39</span><span class="pl-en"> f0             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4011cb:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4011d2 &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xde</span><span class="pl-en">&gt;</span>
<span class="pl-en">  4011cd:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> d1             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span>
<span class="pl-en">  4011d0:	eb eb                	</span><span class="pl-k">jmp</span><span class="pl-en">    4011bd &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xc9</span><span class="pl-en">&gt;</span>
<span class="pl-en">  4011d2:	</span><span class="pl-c1">48</span><span class="pl-en"> c7 </span><span class="pl-c1">42</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	</span><span class="pl-k">movq</span>   <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)</span>
<span class="pl-en">  4011d9:	</span><span class="pl-c1">00</span><span class="pl-en"> </span>
<span class="pl-en">  # Part </span><span class="pl-c1">6</span>
<span class="pl-en">  4011da:	bd </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x5</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebp</span>
<span class="pl-en">  4011df:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">43</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4011e3:	8b </span><span class="pl-c1">00</span><span class="pl-en">                	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  4011e5:	</span><span class="pl-c1">39</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en">                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span>
<span class="pl-en">  4011e7:	7d </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jge</span><span class="pl-en">    4011ee &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xfa</span><span class="pl-en">&gt;</span>
<span class="pl-en">  4011e9:	e8 4c </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  4011ee:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b 5b </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011f2:	</span><span class="pl-c1">83</span><span class="pl-en"> ed </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebp</span>
<span class="pl-en">  4011f5:	</span><span class="pl-c1">75</span><span class="pl-en"> e8                	</span><span class="pl-k">jne</span><span class="pl-en">    4011df &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xeb</span><span class="pl-en">&gt;</span>
<span class="pl-en">  # Part </span><span class="pl-c1">7</span>
<span class="pl-en">  4011f7:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">50</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x50</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  4011fb:	5b                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011fc:	5d                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbp</span>
<span class="pl-en">  4011fd:	</span><span class="pl-c1">41</span><span class="pl-en"> 5c                	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">r12</span>
<span class="pl-en">  4011ff:	</span><span class="pl-c1">41</span><span class="pl-en"> 5d                	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">r13</span>
<span class="pl-en">  </span><span class="pl-c1">401201</span><span class="pl-en">:	</span><span class="pl-c1">41</span><span class="pl-en"> 5e                	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">r14</span>
<span class="pl-en">  </span><span class="pl-c1">401203</span><span class="pl-en">:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en"> </span></pre></div>
<p>太长了，我们一点一点的分析：</p>
<div class="markdown-alert markdown-alert-tip"><p class="markdown-alert-title"><svg class="octicon octicon-light-bulb mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>一些对较长的原程序的阶段划分方法：</p>
<p><code class="notranslate">call &lt;explode_bomb&gt;</code> 可以帮助拆分一个程序的不同部分，虽然它不一定表示一个部分的结束</p>
<p>在之前的 <code class="notranslate">Phase</code> 遇到的相似代码也可以帮助拆分程序，让程序看上去更加有熟悉感</p>
<p><code class="notranslate">j</code> 类型指令也有一定的参考作用</p>
</div>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">00000000004010f4 &lt;phase_6&gt;:</span>
<span class="pl-en">  # Part </span><span class="pl-c1">1</span>
<span class="pl-en">  4010f4:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">56</span><span class="pl-en">                	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">r14</span><span class="pl-en">						# 一些压栈操作，这些寄存器都是 “被调用者保存寄存器”</span>
<span class="pl-en">  4010f6:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">55</span><span class="pl-en">                	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">r13</span>
<span class="pl-en">  4010f8:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en">                	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">r12</span>
<span class="pl-en">  4010fa:	</span><span class="pl-c1">55</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbp</span>
<span class="pl-en">  4010fb:	</span><span class="pl-c1">53</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4010fc:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">50</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x50</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401100</span><span class="pl-en">:	</span><span class="pl-c1">49</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e5             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r13</span>
<span class="pl-en">  </span><span class="pl-c1">401103</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e6             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401106</span><span class="pl-en">:	e8 </span><span class="pl-c1">51</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40145c &lt;read_six_numbers&gt;</span>
<span class="pl-en">  40110b:	</span><span class="pl-c1">49</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e6             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r14</span>
<span class="pl-en">  40110e:	</span><span class="pl-c1">41</span><span class="pl-en"> bc </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">    	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r12d</span></pre></div>
<p>读取六个数字分别位于 <code class="notranslate">%rsp</code> ~ <code class="notranslate">%rsp+0x14</code> 处，<code class="notranslate">%r13</code> <code class="notranslate">%r14</code> <code class="notranslate">%rsi</code> 都设置为 <code class="notranslate">%rsp</code> （也就是指向 <code class="notranslate">num1</code>），<code class="notranslate">%r12d</code> 设置为 <code class="notranslate">0</code></p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">2</span>
<span class="pl-en">  </span><span class="pl-c1">401114</span><span class="pl-en">:	4c </span><span class="pl-c1">89</span><span class="pl-en"> ed             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">r13</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbp</span>
<span class="pl-en">  </span><span class="pl-c1">401117</span><span class="pl-en">:	</span><span class="pl-c1">41</span><span class="pl-en"> 8b </span><span class="pl-c1">45</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x0</span><span class="pl-en">(%</span><span class="pl-v">r13</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40111b:	</span><span class="pl-c1">83</span><span class="pl-en"> e8 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40111e:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">05</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x5</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401121</span><span class="pl-en">:	</span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jbe</span><span class="pl-en">    </span><span class="pl-c1">401128</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x34</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401123</span><span class="pl-en">:	e8 </span><span class="pl-c1">12</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401128</span><span class="pl-en">:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">01</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r12d</span>
<span class="pl-en">  40112c:	</span><span class="pl-c1">41</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> fc </span><span class="pl-c1">06</span><span class="pl-en">          	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r12d</span>
<span class="pl-en">  </span><span class="pl-c1">401130</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">21</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     </span><span class="pl-c1">401153</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x5f</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401132</span><span class="pl-en">:	</span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> e3             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">r12d</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebx</span>
<span class="pl-en">  </span><span class="pl-c1">401135</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">63</span><span class="pl-en"> c3             	movslq %</span><span class="pl-v">ebx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  </span><span class="pl-c1">401138</span><span class="pl-en">:	8b </span><span class="pl-c1">04</span><span class="pl-en"> </span><span class="pl-c1">84</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">4</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40113b:	</span><span class="pl-c1">39</span><span class="pl-en"> </span><span class="pl-c1">45</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-c1">0x0</span><span class="pl-en">(%</span><span class="pl-v">rbp</span><span class="pl-en">)</span>
<span class="pl-en">  40113e:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401145</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x51</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401140</span><span class="pl-en">:	e8 f5 </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401145</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> c3 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebx</span>
<span class="pl-en">  </span><span class="pl-c1">401148</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> fb </span><span class="pl-c1">05</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x5</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebx</span>
<span class="pl-en">  40114b:	7e e8                	</span><span class="pl-k">jle</span><span class="pl-en">    </span><span class="pl-c1">401135</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x41</span><span class="pl-en">&gt; </span>
<span class="pl-en">  40114d:	</span><span class="pl-c1">49</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c5 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r13</span>
<span class="pl-en">  </span><span class="pl-c1">401151</span><span class="pl-en">:	eb c1                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401114</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x20</span><span class="pl-en">&gt;</span></pre></div>
<p>将 <code class="notranslate">%rbp</code> 设置为 <code class="notranslate">%r13</code>， <code class="notranslate">%eax</code> 设置为 <code class="notranslate">(%r13)</code> ，也就是 <code class="notranslate">num1</code>的值，然后将其减去 <code class="notranslate">1</code> 和 <code class="notranslate">5</code> 进行无符号比较，如果 <code class="notranslate">&lt;=</code> 成立就跳转，否则炸弹爆炸，这里说明第一个数字必须 <code class="notranslate">&lt;= 6</code> （注意到是无符号比较并且有减一操作，因此这个数也必须 <code class="notranslate">&gt;= 1</code>）。</p>
<p>接下来将 <code class="notranslate">%r12d</code> （此时为 <code class="notranslate">0</code>）自增并与 <code class="notranslate">6</code> 比较，如果相等就跳转到 <code class="notranslate">401153</code> 处（跳离上面的代码阶段）。这里是一个循环计数器的体现，循环六次。</p>
<p>否则将自增后的 <code class="notranslate">%r12d</code> （此时为 <code class="notranslate">1</code>）赋值给 <code class="notranslate">%ebx</code>，这个值经过符号扩展后传递给 <code class="notranslate">%rax</code>，接下来 <code class="notranslate">%eax</code> = <code class="notranslate">(%rsp + 4 * %rax)</code> ，这一部分的操作逻辑很像数组索引的计算，事实上 <code class="notranslate">%eax</code> 被赋值为 “下一个数字”</p>
<p>接下来比较 <code class="notranslate">%rbp</code> 指向的值与 <code class="notranslate">%eax</code> 内容是否相等，如果相等就爆炸，注意到 <code class="notranslate">%rbp</code> 是第一个数，因此以上的一轮操作是为了确保 “输入的前两个数不相等”</p>
<p>而接下来的三行指令（从 <code class="notranslate">401145</code> 开始）将 <code class="notranslate">%ebx</code> 自增并与 <code class="notranslate">5</code> 比较，如果 <code class="notranslate">&lt;=</code> 成立就回到 <code class="notranslate">401135</code> 重新进行 “再下一个数字” 与第一个数字的比较，可见 “第一个数应该与它后面的所有数都不一样”</p>
<p>最后是对 <code class="notranslate">%r13</code> 增加 <code class="notranslate">4</code> （一个数字的长度，也就是移动到下一个元素），进行以上所有操作的循环</p>
<p>这些内容可以总结为下面的 C 语言函数表示：<strong>检测输入的六个数是否可以组成 <code class="notranslate">1 2 3 4 5 6</code> 的某种无重复排列</strong>（比如 <code class="notranslate">2 5 1 4 6 3</code>）</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-smi">void</span> <span class="pl-en">check_1_to_6_permutation</span>(<span class="pl-smi">int</span> <span class="pl-s1">nums</span>[<span class="pl-c1">6</span>]) {	<span class="pl-c">// 是否满足 1~6 的排列</span>
    <span class="pl-c">// 检查每个数字是否在 1-6 范围内</span>
    <span class="pl-k">for</span> (<span class="pl-smi">int</span> <span class="pl-s1">i</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>; <span class="pl-s1">i</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">6</span>; <span class="pl-s1">i</span><span class="pl-c1">++</span>) {
        <span class="pl-k">if</span> (<span class="pl-s1">nums</span>[<span class="pl-s1">i</span>] <span class="pl-c1">&lt;</span> <span class="pl-c1">1</span> <span class="pl-c1">||</span> <span class="pl-s1">nums</span>[<span class="pl-s1">i</span>] <span class="pl-c1">&gt;</span> <span class="pl-c1">6</span>) <span class="pl-en">explode_bomb</span>();
        <span class="pl-c">// 检查当前数字是否与后续数字重复</span>
        <span class="pl-k">for</span> (<span class="pl-smi">int</span> <span class="pl-s1">j</span> <span class="pl-c1">=</span> <span class="pl-s1">i</span> <span class="pl-c1">+</span> <span class="pl-c1">1</span>; <span class="pl-s1">j</span> <span class="pl-c1">&lt;</span> <span class="pl-c1">6</span>; <span class="pl-s1">j</span><span class="pl-c1">++</span>)
            <span class="pl-k">if</span> (<span class="pl-s1">nums</span>[<span class="pl-s1">i</span>] <span class="pl-c1">==</span> <span class="pl-s1">nums</span>[<span class="pl-s1">j</span>]) <span class="pl-en">explode_bomb</span>();
    }
}</pre></div>
<p>在了解了输入内容要求后继续分析下面的部分：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">3</span>
<span class="pl-en">  </span><span class="pl-c1">401153</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">18</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x18</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401158</span><span class="pl-en">:	4c </span><span class="pl-c1">89</span><span class="pl-en"> f0             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">r14</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  40115b:	b9 </span><span class="pl-c1">07</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x7</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span>
<span class="pl-en">  </span><span class="pl-c1">401160</span><span class="pl-en">:	</span><span class="pl-c1">89</span><span class="pl-en"> ca                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">ecx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401162</span><span class="pl-en">:	2b </span><span class="pl-c1">10</span><span class="pl-en">                	</span><span class="pl-k">sub</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401164</span><span class="pl-en">:	</span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">edx</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-en">)</span>
<span class="pl-en">  </span><span class="pl-c1">401166</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  40116a:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">39</span><span class="pl-en"> f0             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  40116d:	</span><span class="pl-c1">75</span><span class="pl-en"> f1                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401160</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x6c</span><span class="pl-en">&gt;</span></pre></div>
<p><code class="notranslate">%rsi</code> 的地址修改为 <code class="notranslate">%rsp + 0x18</code> ，<code class="notranslate">%rax</code> 被赋值为 <code class="notranslate">%r14</code> （<code class="notranslate">%r14</code> 在之前指向了 <code class="notranslate">num1</code> ），<code class="notranslate">%ecx</code> 设置为常数 <code class="notranslate">7</code></p>
<p>将 <code class="notranslate">%edx</code> 设置为了 <code class="notranslate">7 - num1</code> （<code class="notranslate">%rcx</code> - <code class="notranslate">(%rax)</code>），然后将 <code class="notranslate">%rax</code> 指向的内容修改为了 <code class="notranslate">%edx</code> ，接着将 <code class="notranslate">%rax</code> 增加四（从而指向下一个数字），判断 <code class="notranslate">%rax</code> 和 <code class="notranslate">%rsi</code> 是否相同，不相同则跳转到赋值 <code class="notranslate">%edx</code> 的循环（循环计数器）</p>
<p>上面这一阶段的作用是将**每一个数字 <code class="notranslate">num</code> 修改为 <code class="notranslate">7 - num</code> **</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">4</span>
<span class="pl-en">  40116f:	be </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span>
<span class="pl-en">  </span><span class="pl-c1">401174</span><span class="pl-en">:	eb </span><span class="pl-c1">21</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401197</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xa3</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401176</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">52</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span>
<span class="pl-en">  40117a:	</span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40117d:	</span><span class="pl-c1">39</span><span class="pl-en"> c8                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">ecx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40117f:	</span><span class="pl-c1">75</span><span class="pl-en"> f5                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401176</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x82</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401181</span><span class="pl-en">:	eb </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401188</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x94</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401183</span><span class="pl-en">:	ba d0 </span><span class="pl-c1">32</span><span class="pl-en"> </span><span class="pl-c1">60</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6032d0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401188</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">20</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdx</span><span class="pl-s1">,</span><span class="pl-c1">0x20</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-c1">2</span><span class="pl-en">)</span>
<span class="pl-en">  40118d:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c6 </span><span class="pl-c1">04</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401191</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> fe </span><span class="pl-c1">18</span><span class="pl-en">          	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x18</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span>
<span class="pl-en">  </span><span class="pl-c1">401195</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">14</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4011ab &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xb7</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401197</span><span class="pl-en">:	8b 0c </span><span class="pl-c1">34</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rsp</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span>
<span class="pl-en">  40119a:	</span><span class="pl-c1">83</span><span class="pl-en"> f9 </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ecx</span>
<span class="pl-en">  40119d:	7e e4                	</span><span class="pl-k">jle</span><span class="pl-en">    </span><span class="pl-c1">401183</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x8f</span><span class="pl-en">&gt;</span>
<span class="pl-en">  40119f:	b8 </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  4011a4:	ba d0 </span><span class="pl-c1">32</span><span class="pl-en"> </span><span class="pl-c1">60</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6032d0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  4011a9:	eb cb                	</span><span class="pl-k">jmp</span><span class="pl-en">    </span><span class="pl-c1">401176</span><span class="pl-en"> &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0x82</span><span class="pl-en">&gt;</span></pre></div>
<p>这一段开始出现了很多的跳转操作，我们尝试模拟一遍程序运行的流程。这里有一个 Mermaid 图表可供流程参考：</p>
<div class="markdown-alert markdown-alert-note"><p class="markdown-alert-title"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>Gmeek 渲染似乎不会渲染 Mermaid 图，可以自己把代码复制到其他地方渲染</p>
</div>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">flowchart</span> <span class="pl-c1">TD</span>
    <span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov $0x0,%esi<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">A</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov (%rsp,%rsi,1),%ecx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">C</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span><span class="pl-s"><span class="pl-pds">"</span>cmp $0x1,%ecx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">}</span></span></span>
    <span class="pl-ent">D</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">ecx &lt;= 1</span><span class="pl-k">|</span> <span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov $0x6032d0,%edx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">D</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">ecx &gt; 1</span><span class="pl-k">|</span> <span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov $0x1,%eax&lt;<span class="pl-ent">br</span>&gt;mov $0x6032d0,%edx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">F</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov 0x8(%rdx),%rdx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">I</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>add $0x1,%eax<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">J</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">K</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span><span class="pl-s"><span class="pl-pds">"</span>cmp %ecx,%eax<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">}</span></span></span>
    <span class="pl-ent">K</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">eax != ecx</span><span class="pl-k">|</span> <span class="pl-ent">I</span>
    <span class="pl-ent">K</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">eax == ecx</span><span class="pl-k">|</span> <span class="pl-ent">M</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov %rdx,0x20(%rsp,%rsi,2)&lt;<span class="pl-ent">br</span>&gt;add $0x4,%rsi<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">E</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">M</span>
    <span class="pl-ent">M</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">O</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span><span class="pl-s"><span class="pl-pds">"</span>cmp $0x18,%rsi<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">}</span></span></span>
    <span class="pl-ent">O</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">rsi != 24</span><span class="pl-k">|</span> <span class="pl-ent">C</span>
    <span class="pl-ent">O</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">rsi == 24</span><span class="pl-k">|</span> <span class="pl-ent">P</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>Go to Part 5<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span></pre></div>
<p>看不懂也不要紧，我们不妨先看一下 <code class="notranslate">0x6032d0</code> 的内容：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">(gdb) x/</span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">0x6032d0</span>
<span class="pl-c1">0x6032d0</span><span class="pl-en"> &lt;node1&gt;:	</span><span class="pl-c1">0x0000014c</span><span class="pl-en">		</span><span class="pl-c1">0x00000001</span><span class="pl-en">		</span><span class="pl-c1">0x006032e0</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x6032e0</span><span class="pl-en"> &lt;node2&gt;:	</span><span class="pl-c1">0x000000a8</span><span class="pl-en">		</span><span class="pl-c1">0x00000002</span><span class="pl-en">		</span><span class="pl-c1">0x006032f0</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x6032f0</span><span class="pl-en"> &lt;node3&gt;:	</span><span class="pl-c1">0x0000039c</span><span class="pl-en">		</span><span class="pl-c1">0x00000003</span><span class="pl-en">		</span><span class="pl-c1">0x00603300</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603300</span><span class="pl-en"> &lt;node4&gt;:	</span><span class="pl-c1">0x000002b3</span><span class="pl-en">		</span><span class="pl-c1">0x00000004</span><span class="pl-en">		</span><span class="pl-c1">0x00603310</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603310</span><span class="pl-en"> &lt;node5&gt;:	</span><span class="pl-c1">0x000001dd</span><span class="pl-en">		</span><span class="pl-c1">0x00000005</span><span class="pl-en">		</span><span class="pl-c1">0x00603320</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603320</span><span class="pl-en"> &lt;node6&gt;:	</span><span class="pl-c1">0x000001bb</span><span class="pl-en">		</span><span class="pl-c1">0x00000006</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span><span class="pl-en">		</span><span class="pl-c1">0x00000000</span>
<span class="pl-en"># 注释			   # 一个</span><span class="pl-k">int</span><span class="pl-en">数      # 一个序号	      # 指向的地址，恰好是 node1 </span><span class="pl-s1">-</span><span class="pl-en">&gt; node2 </span><span class="pl-s1">-</span><span class="pl-en">&gt; ... </span><span class="pl-s1">-</span><span class="pl-en">&gt; node6</span></pre></div>
<p>从 <code class="notranslate">&lt;node&gt;</code> 这个标签来看， <code class="notranslate">0x6032d0</code> 开始的地址存储了一个链表，用 C 语言可以这么描述：</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-k">struct</span> <span class="pl-smi">node</span>{
	<span class="pl-smi">int</span> <span class="pl-c1">value</span>;				<span class="pl-c">// 当前节点的值</span>
    <span class="pl-smi">int</span> <span class="pl-c1">label</span>;				<span class="pl-c">// 节点序号</span>
    <span class="pl-k">struct</span> <span class="pl-smi">node</span><span class="pl-c1">*</span> <span class="pl-c1">next</span>;		<span class="pl-c">// 指向的下一节点地址</span>
}</pre></div>
<p>现在再结合 Mermaid 流程图看一遍这段程序：</p>
<p><code class="notranslate">%rsi</code> 作为最外部的循环计数器，初始化为 <code class="notranslate">0</code> ，每次加 <code class="notranslate">4</code> （<code class="notranslate">40118d</code>），加到 <code class="notranslate">24</code> 就停止循环，也就是 <code class="notranslate">for(int i = 0; i &lt; 6; i++)</code></p>
<p>循环内，<code class="notranslate">mov (%rsp,%rsi,1),%ecx</code> 这一步可以看作 <code class="notranslate">int ECX = a[i]</code> ，其中 <code class="notranslate">a</code> 是存储了六个数字的数组（之前的阶段也有类似的程序），<code class="notranslate">%rsi</code> 很明显是一个偏移值，用来遍历整个数组</p>
<p>在 <code class="notranslate">%ecx</code> 被更新赋值以后，其与 <code class="notranslate">1</code> 进行比较：</p>
<p>​	如果这个数 <code class="notranslate">&lt;= 1</code>（结合实际情况也就是判断是否为 <code class="notranslate">1</code>），就把 <code class="notranslate">%edx</code> 设置为 <code class="notranslate">0x6032d0</code> （也就是头节点 <code class="notranslate">node1</code> 的地址）</p>
<p>​	否则 <code class="notranslate">%ecx &gt; 1</code> ，此时将 <code class="notranslate">%eax</code> 设置为 <code class="notranslate">1</code> ，<code class="notranslate">%edx</code> 设置为 <code class="notranslate">0x6032d0</code> ，接下来将 <code class="notranslate">%rdx</code> 设置为 (<code class="notranslate">%rdx + 8</code>) （也就是下一个地址 <code class="notranslate">node-&gt;next</code>），将 <code class="notranslate">%rax</code> 加上一，重复操作直到 <code class="notranslate">%rcx == %rax</code></p>
<p>（也就是说： <code class="notranslate">%edx</code> 被设置为了第 <code class="notranslate">%ecx</code> 个节点的地址）</p>
<p>接下来 <code class="notranslate">mov %rdx,0x20(%rsp,%rsi,2)</code> 将 <code class="notranslate">%rdx</code> 复制到了 <code class="notranslate">(%rsp + 0x20 + 2 * %rsi)</code> 指向的地址处，这个操作将根据最外部的循环计数器遍历整个数组</p>
<p>总结：此阶段<strong>将输入的六个数作为节点序号，依次对应六个节点地址按顺序存储到从 <code class="notranslate">%rsp+20</code> 开始的栈空间处</strong>（构造一个地址数组）</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">5</span>
<span class="pl-en">  4011ab:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b 5c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">20</span><span class="pl-en">       	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x20</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">			# 将上一个 Part 得到的地址数组的第一个地址存入 %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011b0:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">28</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x28</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">			# %</span><span class="pl-v">rax</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en">（第二个元素的地址）</span>
<span class="pl-en">  4011b5:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">50</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x50</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsi</span><span class="pl-en">			# %</span><span class="pl-v">rsi</span><span class="pl-en"> = %</span><span class="pl-v">rsp</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">32</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">6</span><span class="pl-s1">*</span><span class="pl-c1">8</span><span class="pl-en">（地址数组末尾后的地址，也就是arr.end()）</span>
<span class="pl-en">  4011ba:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> d9             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rbx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span><span class="pl-en">				# %</span><span class="pl-v">rcx</span><span class="pl-en"> = %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011bd:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">10</span><span class="pl-en">             	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span><span class="pl-en">				# %</span><span class="pl-v">rdx</span><span class="pl-en"> = (%</span><span class="pl-v">rax</span><span class="pl-en">)</span>
<span class="pl-en">  4011c0:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> </span><span class="pl-c1">51</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdx</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rcx</span><span class="pl-en">)			# %</span><span class="pl-v">rdx</span><span class="pl-en"> 值复制到 (%</span><span class="pl-v">rcx</span><span class="pl-s1">+</span><span class="pl-c1">8</span><span class="pl-en">) 地址</span>
<span class="pl-en">  4011c4:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c0 </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">				# %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en">=</span><span class="pl-c1">8</span>
<span class="pl-en">  4011c8:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">39</span><span class="pl-en"> f0             	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">rsi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-en">				# 比较 %</span><span class="pl-v">rax</span><span class="pl-en"> ~ %</span><span class="pl-v">rsi</span>
<span class="pl-en">  4011cb:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     4011d2 &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xde</span><span class="pl-en">&gt;	# 如果相等就跳转至 4011d2</span>
<span class="pl-en">  4011cd:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> d1             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rdx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span><span class="pl-en">				# 否则 %</span><span class="pl-v">rcx</span><span class="pl-en"> = %</span><span class="pl-v">rdx</span>
<span class="pl-en">  4011d0:	eb eb                	</span><span class="pl-k">jmp</span><span class="pl-en">    4011bd &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xc9</span><span class="pl-en">&gt;	# 并且跳回到 4011bd</span>
<span class="pl-en">  4011d2:	</span><span class="pl-c1">48</span><span class="pl-en"> c7 </span><span class="pl-c1">42</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> 	</span><span class="pl-k">movq</span>   <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rdx</span><span class="pl-en">)			# %</span><span class="pl-v">rax</span><span class="pl-en"> == %</span><span class="pl-v">rsi</span><span class="pl-en"> 时，将 </span><span class="pl-c1">0</span><span class="pl-en"> 存储到内存地址为 %</span><span class="pl-v">rdx</span><span class="pl-en"> </span><span class="pl-s1">+</span><span class="pl-en"> </span><span class="pl-c1">8</span><span class="pl-en"> 的位置</span>
<span class="pl-en">  4011d9:	</span><span class="pl-c1">00</span><span class="pl-en"> </span></pre></div>
<p>不妨记上一个 Part 构造的地址数组为 <code class="notranslate">addr[6]</code>， 用 C++ 重写程序</p>
<div class="highlight highlight-source-c++"><pre class="notranslate">Node* <span class="pl-en">Part5</span>(Node* addr[]) {
    Node* first = addr[<span class="pl-c1">0</span>];							<span class="pl-c"><span class="pl-c">//</span> %rbx = addr[0]</span>
    Node* current = first;							<span class="pl-c"><span class="pl-c">//</span> %rcx = %rbx</span>
    <span class="pl-c"><span class="pl-c">//</span> 从第二个元素开始遍历地址数组</span>
    <span class="pl-k">for</span> (<span class="pl-k">int</span> i = <span class="pl-c1">1</span>; i &lt; <span class="pl-c1">6</span>; i++) {					<span class="pl-c"><span class="pl-c">//</span> for (%rax = &amp;addr[1], %rax &lt; addr.end(), %rax++) </span>
        current-&gt;<span class="pl-smi">next</span> = addr[i];  					<span class="pl-c"><span class="pl-c">//</span> 当前节点的下一节点由 addr[i] 决定</span>
        current = current-&gt;<span class="pl-smi">next</span>;        			<span class="pl-c"><span class="pl-c">//</span> 移动到下一个节点 </span>
    }
    
    current-&gt;<span class="pl-smi">next</span> = <span class="pl-c1">nullptr</span>;      					<span class="pl-c"><span class="pl-c">//</span> 对应 movq $0x0,0x8(%rdx)，作用是终止链表</span>
    <span class="pl-k">return</span> first;									<span class="pl-c"><span class="pl-c">//</span> 得到一个</span>
}</pre></div>
<p><code class="notranslate">0x6032d0</code> 处的原始链表记为 <code class="notranslate">node1 -&gt; ... -&gt; node6</code>，这一部分程序<strong>根据输入的六个数字顺序重新链接了链表</strong></p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">6</span>
<span class="pl-en">  4011da:	bd </span><span class="pl-c1">05</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x5</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebp</span>
<span class="pl-en">  4011df:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b </span><span class="pl-c1">43</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span>
<span class="pl-en">  4011e3:	8b </span><span class="pl-c1">00</span><span class="pl-en">                	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  4011e5:	</span><span class="pl-c1">39</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en">                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span>
<span class="pl-en">  4011e7:	7d </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jge</span><span class="pl-en">    4011ee &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xfa</span><span class="pl-en">&gt;</span>
<span class="pl-en">  4011e9:	e8 4c </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;</span>
<span class="pl-en">  4011ee:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b 5b </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rbx</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011f2:	</span><span class="pl-c1">83</span><span class="pl-en"> ed </span><span class="pl-c1">01</span><span class="pl-en">             	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x1</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">ebp</span>
<span class="pl-en">  4011f5:	</span><span class="pl-c1">75</span><span class="pl-en"> e8                	</span><span class="pl-k">jne</span><span class="pl-en">    4011df &lt;phase_6</span><span class="pl-s1">+</span><span class="pl-c1">0xeb</span><span class="pl-en">&gt;</span></pre></div>
<p>这一部分程序的内容十分明显了：重新链接后的链表的存储的值必须降序，否则引爆炸弹。正确的链表连接方式是 <code class="notranslate">3 -&gt; 4 -&gt; 5 -&gt; 6 -&gt; 1 -&gt; 2</code></p>
<p>考虑到 Part 3 将每一个数 <code class="notranslate">num</code> 改写为 <code class="notranslate">7 - num</code> ，所以整个 Phase 最终的答案就是 <code class="notranslate">4 3 2 1 6 5</code></p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  # Part </span><span class="pl-c1">7</span>
<span class="pl-en">  4011f7:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">50</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x50</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  4011fb:	5b                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbx</span>
<span class="pl-en">  4011fc:	5d                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbp</span>
<span class="pl-en">  4011fd:	</span><span class="pl-c1">41</span><span class="pl-en"> 5c                	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">r12</span>
<span class="pl-en">  4011ff:	</span><span class="pl-c1">41</span><span class="pl-en"> 5d                	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">r13</span>
<span class="pl-en">  </span><span class="pl-c1">401201</span><span class="pl-en">:	</span><span class="pl-c1">41</span><span class="pl-en"> 5e                	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">r14</span>
<span class="pl-en">  </span><span class="pl-c1">401203</span><span class="pl-en">:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en"> </span></pre></div>
<p>清理栈帧并恢复被调用者保存的寄存器，不需要多分析</p>
<h4>Secret Phase</h4>
<p>结束六个常规的 Phase 后并没有发现任何触发 Secret Phase 的代码段，这里采用了一个比较投机的操作：搜索出现了 <code class="notranslate">401242</code> 地址的函数</p>
<p>函数 <code class="notranslate">&lt;phase_defused&gt;</code> 的使用场景是：在 main 函数中，在每一个炸弹被拆除时被调用，而 <code class="notranslate">401630</code> 地址处出现了跳转至隐藏阶段的跳转函数，对这个函数的相关部分进行分析：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en">  4015e1:	4c 8d </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">r8</span>
<span class="pl-en">  4015e6:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 4c </span><span class="pl-c1">24</span><span class="pl-en"> 0c       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0xc</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rcx</span>
<span class="pl-en">  4015eb:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d </span><span class="pl-c1">54</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">08</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdx</span>
<span class="pl-en">  4015f0:	be </span><span class="pl-c1">19</span><span class="pl-en"> </span><span class="pl-c1">26</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x402619</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">					# (gdb) x/s </span><span class="pl-c1">0x402619</span><span class="pl-en">: </span><span class="pl-s">"%d %d %s"</span>
<span class="pl-en">  4015f5:	bf </span><span class="pl-c1">70</span><span class="pl-en"> </span><span class="pl-c1">38</span><span class="pl-en"> </span><span class="pl-c1">60</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x603870</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span><span class="pl-en">					# </span><span class="pl-c1">0x603870</span><span class="pl-en"> &lt;input_strings</span><span class="pl-s1">+</span><span class="pl-c1">240</span><span class="pl-en">&gt;:	</span><span class="pl-s">""</span>
<span class="pl-en">  4015fa:	e8 f1 f5 ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400bf0 &lt;__isoc99_sscanf@plt&gt;</span>
<span class="pl-en">  4015ff:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">03</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x3</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401602</span><span class="pl-en">:	</span><span class="pl-c1">75</span><span class="pl-en"> </span><span class="pl-c1">31</span><span class="pl-en">                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401635</span><span class="pl-en"> &lt;phase_defused</span><span class="pl-s1">+</span><span class="pl-c1">0x71</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401604</span><span class="pl-en">:	be </span><span class="pl-c1">22</span><span class="pl-en"> </span><span class="pl-c1">26</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x402622</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">					# </span><span class="pl-c1">0x402622</span><span class="pl-en">:	</span><span class="pl-s">"DrEvil"</span>
<span class="pl-en">  </span><span class="pl-c1">401609</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8d 7c </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">10</span><span class="pl-en">       	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rsp</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span>
<span class="pl-en">  40160e:	e8 </span><span class="pl-c1">25</span><span class="pl-en"> fd ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401338</span><span class="pl-en"> &lt;strings_not_equal&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401613</span><span class="pl-en">:	</span><span class="pl-c1">85</span><span class="pl-en"> c0                	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401615</span><span class="pl-en">:	</span><span class="pl-c1">75</span><span class="pl-en"> 1e                	</span><span class="pl-k">jne</span><span class="pl-en">    </span><span class="pl-c1">401635</span><span class="pl-en"> &lt;phase_defused</span><span class="pl-s1">+</span><span class="pl-c1">0x71</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401617</span><span class="pl-en">:	bf f8 </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x4024f8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span>
<span class="pl-en">  40161c:	e8 ef f4 ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400b10 &lt;puts@plt&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401621</span><span class="pl-en">:	bf </span><span class="pl-c1">20</span><span class="pl-en"> </span><span class="pl-c1">25</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x402520</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span>
<span class="pl-en">  </span><span class="pl-c1">401626</span><span class="pl-en">:	e8 e5 f4 ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400b10 &lt;puts@plt&gt;</span>
<span class="pl-en">  40162b:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401630</span><span class="pl-en">:	e8 0d fc ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401242</span><span class="pl-en"> &lt;secret_phase&gt;</span></pre></div>
<p>很明显这个特殊的密码是 <code class="notranslate">DrEvil</code> ，而正确输入密码的方式是在某个阶段的输入中输入两个整数 + 字符串（即 <code class="notranslate">DrEvil</code>）。</p>
<p>（具体一点来说：将 <code class="notranslate">0x402619</code> 作为输入格式，将 <code class="notranslate">0x603870</code> 作为输入（一定是之前某一个阶段的输入），提取出 <code class="notranslate">%s</code> 判断是否为 <code class="notranslate">DrEvil</code>）</p>
<p>我们知道 Phase 3 和 Phase 4 需要输入的都是两个数字，所以哪一个阶段应该多一个输入呢？我们不妨使用gdb调试，在 Phase 5 开始的时候打一个断点，然后检查 <code class="notranslate">0x603870</code> 的内容</p>
<div class="highlight highlight-source-gdb"><pre class="notranslate">(gdb) break *<span class="pl-c1">0x401062</span>
Breakpoint <span class="pl-c1">1</span> at <span class="pl-c1">0x401062</span>
(gdb) r
Starting <span class="pl-k">program</span>: /home/nopthon/Desktop/bomb/bomb 
[Thread debugging using libthread_db enabled]
Using host libthread_db library <span class="pl-s"><span class="pl-pds">"</span>/lib/x86_64-linux-gnu/libthread_db.so.1<span class="pl-pds">"</span></span>.
Welcome to my fiendish little bomb. You have <span class="pl-c1">6</span> phases with
which to blow yourself up. Have a nice day!
Border relations with Canada have never been better.
Phase <span class="pl-c1">1</span> defused. How about the next one?
<span class="pl-c1">1</span> <span class="pl-c1">2</span> <span class="pl-c1">4</span> <span class="pl-c1">8</span> <span class="pl-c1">16</span> <span class="pl-c1">32</span>
That<span class="pl-s"><span class="pl-pds">'</span>s number 2.  Keep going!</span>
<span class="pl-s">2 707																				# Phase 3 的输入</span>
<span class="pl-s">Halfway there!</span>
<span class="pl-s">1 0																					# Phase 4 的输入</span>
<span class="pl-s">So you got that one.  Try this one.</span>
<span class="pl-s">^_^(a breakpoint here)</span>
<span class="pl-s"></span>
<span class="pl-s">Breakpoint 1, 0x0000000000401062 in phase_5 ()</span>
<span class="pl-s">(gdb) x/s 0x603870</span>
<span class="pl-s">0x603870 &lt;input_strings+240&gt;:	"1 0"												# Phase 4 的输入</span></pre></div>
<p>我们发现 <code class="notranslate">0x603870</code> 存储的是第四阶段的输入，因此在第四阶段的输入中多输入一个字符串 <code class="notranslate">DrEvil</code> 就可以进入隐藏阶段（比如 <code class="notranslate">1 0 DrEvil</code>）</p>
<p>下面是隐藏阶段的代码：</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-c1">0000000000401242</span><span class="pl-en"> &lt;secret_phase&gt;:</span>
<span class="pl-en">  </span><span class="pl-c1">401242</span><span class="pl-en">:	</span><span class="pl-c1">53</span><span class="pl-en">                   	</span><span class="pl-k">push</span><span class="pl-en">   %</span><span class="pl-v">rbx</span><span class="pl-en">								# 被调用者保存寄存器</span>
<span class="pl-en">  </span><span class="pl-c1">401243</span><span class="pl-en">:	e8 </span><span class="pl-c1">56</span><span class="pl-en"> </span><span class="pl-c1">02</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40149e &lt;read_line&gt;				# 读取一行内容，返回值 %</span><span class="pl-v">rax</span>
<span class="pl-en">  </span><span class="pl-c1">401248</span><span class="pl-en">:	ba 0a </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xa</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span><span class="pl-en">						# %</span><span class="pl-v">edx</span><span class="pl-en"> = </span><span class="pl-c1">10</span>
<span class="pl-en">  40124d:	be </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">						# %</span><span class="pl-v">esi</span><span class="pl-en"> = </span><span class="pl-c1">0</span>
<span class="pl-en">  </span><span class="pl-c1">401252</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> c7             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span><span class="pl-en">						# %</span><span class="pl-v">rdi</span><span class="pl-en"> = %</span><span class="pl-v">rax</span>
<span class="pl-en">  </span><span class="pl-c1">401255</span><span class="pl-en">:	e8 </span><span class="pl-c1">76</span><span class="pl-en"> f9 ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400bd0 &lt;strtol@plt&gt;				# 调用 C 语言函数 strtol() ，字符串转化为 long 整数</span>
<span class="pl-en">  40125a:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">89</span><span class="pl-en"> c3             	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rbx</span><span class="pl-en">						# 返回值（整数） %</span><span class="pl-v">rax</span><span class="pl-en"> 存入 %</span><span class="pl-v">rbx</span>
<span class="pl-en">  40125d:	8d </span><span class="pl-c1">40</span><span class="pl-en"> ff             	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-s1">-</span><span class="pl-c1">0x1</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">					# %</span><span class="pl-v">rax</span><span class="pl-en"> = %</span><span class="pl-v">rax</span><span class="pl-en"> </span><span class="pl-s1">-</span><span class="pl-en"> </span><span class="pl-c1">1</span><span class="pl-en"> （地址计算）</span>
<span class="pl-en">  </span><span class="pl-c1">401260</span><span class="pl-en">:	3d e8 </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x3e8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">						# %</span><span class="pl-v">eax</span><span class="pl-en"> 与 </span><span class="pl-c1">1000</span><span class="pl-en"> 比较</span>
<span class="pl-en">  </span><span class="pl-c1">401265</span><span class="pl-en">:	</span><span class="pl-c1">76</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jbe</span><span class="pl-en">    40126c &lt;secret_phase</span><span class="pl-s1">+</span><span class="pl-c1">0x2a</span><span class="pl-en">&gt;		# %</span><span class="pl-v">eax</span><span class="pl-en"> &lt;= </span><span class="pl-c1">1000</span><span class="pl-en"> 则跳转</span>
<span class="pl-en">  </span><span class="pl-c1">401267</span><span class="pl-en">:	e8 ce </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;			# 否则 BOOM! </span>
<span class="pl-en">  40126c:	</span><span class="pl-c1">89</span><span class="pl-en"> de                	</span><span class="pl-k">mov</span><span class="pl-en">    %</span><span class="pl-v">ebx</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">esi</span><span class="pl-en">						# %</span><span class="pl-v">esi</span><span class="pl-en"> = %</span><span class="pl-v">ebx</span><span class="pl-en"> （也就是之前的返回值）</span>
<span class="pl-en">  40126e:	bf f0 </span><span class="pl-c1">30</span><span class="pl-en"> </span><span class="pl-c1">60</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x6030f0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span>
<span class="pl-en">  </span><span class="pl-c1">401273</span><span class="pl-en">:	e8 8c ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401204</span><span class="pl-en"> &lt;fun7&gt;					# 调用 fun7 函数</span>
<span class="pl-en">  </span><span class="pl-c1">401278</span><span class="pl-en">:	</span><span class="pl-c1">83</span><span class="pl-en"> f8 </span><span class="pl-c1">02</span><span class="pl-en">             	</span><span class="pl-k">cmp</span>    <span class="pl-c1">$</span><span class="pl-c1">0x2</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span><span class="pl-en">						# 返回值 %</span><span class="pl-v">eax</span><span class="pl-en"> 与 </span><span class="pl-c1">2</span><span class="pl-en"> 比较</span>
<span class="pl-en">  40127b:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     </span><span class="pl-c1">401282</span><span class="pl-en"> &lt;secret_phase</span><span class="pl-s1">+</span><span class="pl-c1">0x40</span><span class="pl-en">&gt;		# 如果相等就跳转（代表拆弹成功）</span>
<span class="pl-en">  40127d:	e8 b8 </span><span class="pl-c1">01</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   40143a &lt;explode_bomb&gt;			# 否则 BOOM!</span>
<span class="pl-en">  </span><span class="pl-c1">401282</span><span class="pl-en">:	bf </span><span class="pl-c1">38</span><span class="pl-en"> </span><span class="pl-c1">24</span><span class="pl-en"> </span><span class="pl-c1">40</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x402438</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edi</span><span class="pl-en">					# 这里存的是拆弹成功的祝贺语 :)</span>
<span class="pl-en">  </span><span class="pl-c1">401287</span><span class="pl-en">:	e8 </span><span class="pl-c1">84</span><span class="pl-en"> f8 ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   400b10 &lt;puts@plt&gt;</span>
<span class="pl-en">  40128c:	e8 </span><span class="pl-c1">33</span><span class="pl-en"> </span><span class="pl-c1">03</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">call</span><span class="pl-en">   4015c4 &lt;phase_defused&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401291</span><span class="pl-en">:	5b                   	</span><span class="pl-k">pop</span><span class="pl-en">    %</span><span class="pl-v">rbx</span>
<span class="pl-en">  </span><span class="pl-c1">401292</span><span class="pl-en">:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en">    </span>
<span class="pl-en">  </span><span class="pl-c1">401293</span><span class="pl-en">:	</span><span class="pl-c1">90</span><span class="pl-en">                   	</span><span class="pl-k">nop</span>
<span class="pl-en">  ... ... # 很多的 </span><span class="pl-k">nop</span>
<span class="pl-en">  40129f:	</span><span class="pl-c1">90</span><span class="pl-en">                   	</span><span class="pl-k">nop</span>

<span class="pl-c1">0000000000401204</span><span class="pl-en"> &lt;fun7&gt;:</span>
<span class="pl-en">  </span><span class="pl-c1">401204</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> ec </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">sub</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span><span class="pl-en">						# 分配栈空间</span>
<span class="pl-en">  </span><span class="pl-c1">401208</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">85</span><span class="pl-en"> ff             	</span><span class="pl-k">test</span><span class="pl-en">   %</span><span class="pl-v">rdi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span>
<span class="pl-en">  40120b:	</span><span class="pl-c1">74</span><span class="pl-en"> 2b                	</span><span class="pl-k">je</span><span class="pl-en">     </span><span class="pl-c1">401238</span><span class="pl-en"> &lt;fun7</span><span class="pl-s1">+</span><span class="pl-c1">0x34</span><span class="pl-en">&gt;</span>
<span class="pl-en">  40120d:	8b </span><span class="pl-c1">17</span><span class="pl-en">                	</span><span class="pl-k">mov</span><span class="pl-en">    (%</span><span class="pl-v">rdi</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  40120f:	</span><span class="pl-c1">39</span><span class="pl-en"> f2                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">esi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401211</span><span class="pl-en">:	7e 0d                	</span><span class="pl-k">jle</span><span class="pl-en">    </span><span class="pl-c1">401220</span><span class="pl-en"> &lt;fun7</span><span class="pl-s1">+</span><span class="pl-c1">0x1c</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401213</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b 7f </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x8</span><span class="pl-en">(%</span><span class="pl-v">rdi</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span>
<span class="pl-en">  </span><span class="pl-c1">401217</span><span class="pl-en">:	e8 e8 ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401204</span><span class="pl-en"> &lt;fun7&gt;</span>
<span class="pl-en">  40121c:	</span><span class="pl-c1">01</span><span class="pl-en"> c0                	</span><span class="pl-k">add</span><span class="pl-en">    %</span><span class="pl-v">eax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40121e:	eb 1d                	</span><span class="pl-k">jmp</span><span class="pl-en">    40123d &lt;fun7</span><span class="pl-s1">+</span><span class="pl-c1">0x39</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401220</span><span class="pl-en">:	b8 </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en">       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0x0</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401225</span><span class="pl-en">:	</span><span class="pl-c1">39</span><span class="pl-en"> f2                	</span><span class="pl-k">cmp</span><span class="pl-en">    %</span><span class="pl-v">esi</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">edx</span>
<span class="pl-en">  </span><span class="pl-c1">401227</span><span class="pl-en">:	</span><span class="pl-c1">74</span><span class="pl-en"> </span><span class="pl-c1">14</span><span class="pl-en">                	</span><span class="pl-k">je</span><span class="pl-en">     40123d &lt;fun7</span><span class="pl-s1">+</span><span class="pl-c1">0x39</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401229</span><span class="pl-en">:	</span><span class="pl-c1">48</span><span class="pl-en"> 8b 7f </span><span class="pl-c1">10</span><span class="pl-en">          	</span><span class="pl-k">mov</span><span class="pl-en">    </span><span class="pl-c1">0x10</span><span class="pl-en">(%</span><span class="pl-v">rdi</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rdi</span>
<span class="pl-en">  40122d:	e8 d2 ff ff ff       	</span><span class="pl-k">call</span><span class="pl-en">   </span><span class="pl-c1">401204</span><span class="pl-en"> &lt;fun7&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401232</span><span class="pl-en">:	8d </span><span class="pl-c1">44</span><span class="pl-en"> </span><span class="pl-c1">00</span><span class="pl-en"> </span><span class="pl-c1">01</span><span class="pl-en">          	</span><span class="pl-k">lea</span><span class="pl-en">    </span><span class="pl-c1">0x1</span><span class="pl-en">(%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rax</span><span class="pl-s1">,</span><span class="pl-c1">1</span><span class="pl-en">)</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  </span><span class="pl-c1">401236</span><span class="pl-en">:	eb </span><span class="pl-c1">05</span><span class="pl-en">                	</span><span class="pl-k">jmp</span><span class="pl-en">    40123d &lt;fun7</span><span class="pl-s1">+</span><span class="pl-c1">0x39</span><span class="pl-en">&gt;</span>
<span class="pl-en">  </span><span class="pl-c1">401238</span><span class="pl-en">:	b8 ff ff ff ff       	</span><span class="pl-k">mov</span>    <span class="pl-c1">$</span><span class="pl-c1">0xffffffff</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">eax</span>
<span class="pl-en">  40123d:	</span><span class="pl-c1">48</span><span class="pl-en"> </span><span class="pl-c1">83</span><span class="pl-en"> c4 </span><span class="pl-c1">08</span><span class="pl-en">          	</span><span class="pl-k">add</span>    <span class="pl-c1">$</span><span class="pl-c1">0x8</span><span class="pl-s1">,</span><span class="pl-en">%</span><span class="pl-v">rsp</span>
<span class="pl-en">  </span><span class="pl-c1">401241</span><span class="pl-en">:	c3                   	</span><span class="pl-k">ret</span><span class="pl-en"> </span></pre></div>
<p>主函数部分的程序很清晰，主要关注 <code class="notranslate">fun7</code> 函数的内容</p>
<p>为了方便理解绘制出 <code class="notranslate">fun7</code> 的 Mermaid 示意图：</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">flowchart</span> <span class="pl-c1">TD</span>
    <span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>sub $0x8, %rsp<span class="pl-pds"><span class="pl-sg">]</span></span></span> <span class="pl-k">--&gt;</span> <span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span><span class="pl-s"><span class="pl-pds">"</span>test %rdi, %rdi<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">}</span></span></span>
    <span class="pl-ent">B</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">%rdi == 0</span><span class="pl-k">|</span> <span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov $0xffffffff, %eax<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">B</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">%rdi != 0</span><span class="pl-k">|</span> <span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov (%rdi), %edx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">D</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span><span class="pl-s"><span class="pl-pds">"</span>cmp %esi, %edx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">}</span></span></span>
    <span class="pl-ent">E</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">%edx &lt;= %esi</span><span class="pl-k">|</span> <span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov $0x0, %eax<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">E</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">%edx &gt; %esi</span><span class="pl-k">|</span> <span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov 0x8(%rdi), %rdi<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">G</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>call fun7 (递归)<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">H</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>add %eax, %eax<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">I</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">J</span>
    <span class="pl-ent">F</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">K</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">{</span></span><span class="pl-s"><span class="pl-pds">"</span>cmp %esi, %edx<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">}</span></span></span>
    <span class="pl-ent">K</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">%edx == %esi</span><span class="pl-k">|</span> <span class="pl-ent">J</span>
    <span class="pl-ent">K</span> <span class="pl-k">--&gt;</span><span class="pl-k">|</span><span class="pl-s">%edx != %esi</span><span class="pl-k">|</span> <span class="pl-ent">L</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>mov 0x10(%rdi), %rdi<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">L</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">M</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>call fun7 (递归)<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">M</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">N</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>lea 0x1(%rax,%rax,1), %eax<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">N</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">J</span>
    <span class="pl-ent">C</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">J</span>
    <span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span>add $0x8, %rsp<span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">J</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">P</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>ret (返回)<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>

</pre></div>
<p>存在递归，并且有搜索的模式，考虑是对一个数据结构的操作</p>
<p>在首次调用 <code class="notranslate">fun7</code> 前，被存入 <code class="notranslate">%edi</code> 的（<code class="notranslate">0x6030f0</code>）应该是一个数据结构的起点，可以用 gdb 进行访问</p>
<div class="highlight highlight-source-assembly"><pre class="notranslate"><span class="pl-en"># </span><span class="pl-c1">0x6030f0</span><span class="pl-en"> 处的内容，被存入 %</span><span class="pl-v">edi</span><span class="pl-en"> </span>
<span class="pl-c1">0x6030f0</span><span class="pl-en"> &lt;n1&gt;:		</span><span class="pl-c1">0x00000024</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603110</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603130</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603110</span><span class="pl-en"> &lt;n21&gt;:		</span><span class="pl-c1">0x00000008</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603190</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603150</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603130</span><span class="pl-en"> &lt;n22&gt;:		</span><span class="pl-c1">0x00000032</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603170</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x006031b0</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603150</span><span class="pl-en"> &lt;n32&gt;:		</span><span class="pl-c1">0x00000016</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603270</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603230</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603170</span><span class="pl-en"> &lt;n33&gt;:		</span><span class="pl-c1">0x0000002d</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x006031d0</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603290</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603190</span><span class="pl-en"> &lt;n31&gt;:		</span><span class="pl-c1">0x00000006</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x006031f0</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603250</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x6031b0</span><span class="pl-en"> &lt;n34&gt;:		</span><span class="pl-c1">0x0000006b</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00603210</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x006032b0</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x6031d0</span><span class="pl-en"> &lt;n45&gt;:		</span><span class="pl-c1">0x00000028</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x6031f0</span><span class="pl-en"> &lt;n41&gt;:		</span><span class="pl-c1">0x00000001</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603210</span><span class="pl-en"> &lt;n47&gt;:		</span><span class="pl-c1">0x00000063</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603230</span><span class="pl-en"> &lt;n44&gt;:		</span><span class="pl-c1">0x00000023</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603250</span><span class="pl-en"> &lt;n42&gt;:		</span><span class="pl-c1">0x00000007</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603270</span><span class="pl-en"> &lt;n43&gt;:		</span><span class="pl-c1">0x00000014</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x603290</span><span class="pl-en"> &lt;n46&gt;:		</span><span class="pl-c1">0x0000002f</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-c1">0x6032b0</span><span class="pl-en"> &lt;n48&gt;:		</span><span class="pl-c1">0x000003e9</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span><span class="pl-en">	</span><span class="pl-c1">0x00000000</span>
<span class="pl-en">#					# 存储的值				 # 左分支节点地址			 # 右分支节点地址			# 填充对齐</span></pre></div>
<p>从标签来看很像是一个二叉树结构，考虑每个节点分别存储的内容依次是：</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-k">struct</span> <span class="pl-smi">Node</span>{
	<span class="pl-smi">int</span> <span class="pl-c1">val</span>;
	<span class="pl-smi">Node</span><span class="pl-c1">*</span> <span class="pl-c1">left</span>;
	<span class="pl-smi">Node</span><span class="pl-c1">*</span> <span class="pl-c1">right</span>;
}</pre></div>
<p>据此绘制图像：</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">flowchart</span> <span class="pl-c1">TD</span>
    <span class="pl-ent">n1</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n1 (0x6030f0)&lt;<span class="pl-ent">br</span>/&gt;val: 36<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n1</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n21</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n21 (0x603110)&lt;<span class="pl-ent">br</span>/&gt;val: 8<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n1</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n22</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n22 (0x603130)&lt;<span class="pl-ent">br</span>/&gt;val: 50<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n21</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n31</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n31 (0x603190)&lt;<span class="pl-ent">br</span>/&gt;val: 6<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n21</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n32</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n32 (0x603150)&lt;<span class="pl-ent">br</span>/&gt;val: 22<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n22</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n33</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n33 (0x603170)&lt;<span class="pl-ent">br</span>/&gt;val: 45<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n22</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n34</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n34 (0x6031b0)&lt;<span class="pl-ent">br</span>/&gt;val: 107<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n31</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n41</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n41 (0x6031f0)&lt;<span class="pl-ent">br</span>/&gt;val: 1<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n31</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n42</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n42 (0x603250)&lt;<span class="pl-ent">br</span>/&gt;val: 7<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n32</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n43</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n43 (0x603270)&lt;<span class="pl-ent">br</span>/&gt;val: 20<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n32</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n44</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n44 (0x603230)&lt;<span class="pl-ent">br</span>/&gt;val: 35<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n33</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n45</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n45 (0x6031d0)&lt;<span class="pl-ent">br</span>/&gt;val: 40<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n33</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n46</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n46 (0x603290)&lt;<span class="pl-ent">br</span>/&gt;val: 47<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    
    <span class="pl-ent">n34</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n47</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n47 (0x603210)&lt;<span class="pl-ent">br</span>/&gt;val: 99<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span>
    <span class="pl-ent">n34</span> <span class="pl-k">--&gt;</span> <span class="pl-ent">n48</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">[</span></span><span class="pl-s"><span class="pl-pds">"</span>n48 (0x6032b0)&lt;<span class="pl-ent">br</span>/&gt;val: 1001<span class="pl-pds">"</span></span><span class="pl-pds"><span class="pl-sg">]</span></span></span></pre></div>
<p>不难看出这是一个<a href="https://oiwiki.org/ds/bst/" rel="nofollow">二叉搜索树</a>，而 <code class="notranslate">fun7</code> 的作用可以用 C 语言这样表示：（参见<a href="https://oiwiki.org/ds/bst/#%E6%90%9C%E7%B4%A2%E5%85%83%E7%B4%A0" rel="nofollow">搜索元素</a>，代码非常相近）</p>
<div class="highlight highlight-source-c"><pre class="notranslate"><span class="pl-smi">int</span> <span class="pl-en">fun7</span>(<span class="pl-smi">Node</span> <span class="pl-c1">*</span><span class="pl-s1">node</span>, <span class="pl-smi">int</span> <span class="pl-s1">value</span>) {					<span class="pl-c">// %esi 是一个被查找的值</span>
    <span class="pl-k">if</span> (<span class="pl-s1">node</span> <span class="pl-c1">==</span> <span class="pl-c1">NULL</span>) {
        <span class="pl-k">return</span> <span class="pl-c1">-1</span>;									<span class="pl-c">// %rdi == 0 时，返回值 0xffffffff</span>
    }
    <span class="pl-c">// %rdi != 0:</span>
    <span class="pl-smi">int</span> <span class="pl-s1">node_val</span> <span class="pl-c1">=</span> <span class="pl-s1">node</span><span class="pl-c1">-&gt;</span><span class="pl-c1">value</span>;						<span class="pl-c">// 40120d: mov (%rdi),%edx</span>
    
    <span class="pl-k">if</span> (<span class="pl-s1">node_val</span> &lt;= <span class="pl-s1">value</span>) {						<span class="pl-c">// 401225: cmp %esi,%edx</span>
        <span class="pl-smi">int</span> <span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>;

        <span class="pl-k">if</span> (<span class="pl-s1">node_val</span> <span class="pl-c1">==</span> <span class="pl-s1">value</span>)
            <span class="pl-k">return</span> <span class="pl-s1">res</span>;								<span class="pl-c">// node_val == value</span>
       
        <span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-c1">2</span> <span class="pl-c1">*</span> <span class="pl-en">fun7</span>(<span class="pl-s1">node</span><span class="pl-c1">-&gt;</span><span class="pl-c1">right</span>, <span class="pl-s1">value</span>) <span class="pl-c1">+</span> <span class="pl-c1">1</span>;		<span class="pl-c">// node_val &lt; value</span>
        <span class="pl-k">return</span> <span class="pl-s1">res</span>;
    } <span class="pl-k">else</span> {
        <span class="pl-s1">res</span> <span class="pl-c1">=</span> <span class="pl-c1">2</span> <span class="pl-c1">*</span> <span class="pl-en">fun7</span>(<span class="pl-s1">node</span><span class="pl-c1">-&gt;</span><span class="pl-c1">left</span>, <span class="pl-s1">value</span>);			<span class="pl-c">// node_val &gt; value</span>
        <span class="pl-k">return</span> <span class="pl-s1">res</span>;
    }
}</pre></div>
<p><code class="notranslate">&lt;secret_phase&gt;</code> 主程序要求 <code class="notranslate">fun7</code> 的最终返回值为 <code class="notranslate">2</code>，因此被查找的值应该要从内到外逆推递归，计算<code class="notranslate">2 * (2 * 0 + 1)</code> 作为返回值</p>
<p>比如以 <code class="notranslate">n32</code> 这个节点为例，被查找的值为 <code class="notranslate">22</code>，那么向上逆推递归回到根节点的时候，经历了这样的步骤：</p>
<pre class="notranslate"><code class="notranslate">// 第三层递归
return 0;			// 其实这里也可以是 2*0 的结果，对应节点 n43
// 第二层递归
return 2*fun7 + 1;	// 1
// 第一层递归
return 2*fun7;		// 2
</code></pre>
<p>所以该阶段的最终答案为 <code class="notranslate">20</code> 或 <code class="notranslate">22</code></p>
<hr>
<h2>Final Ans</h2>
<pre lang="ans" class="notranslate"><code class="notranslate">❯ ./bomb
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Border relations with Canada have never been better.			# Phase 1
Phase 1 defused. How about the next one?
1 2 4 8 16 32													# Phase 2
That's number 2.  Keep going!
2 707															# Phase 3
Halfway there!
1 0 DrEvil														# Phase 4
So you got that one.  Try this one.
yonuvw															# Phase 5
Good work!  On to the next...
4 3 2 1 6 5														# Phase 6
Curses, you've found the secret phase!
But finding it and solving it are quite different...
22																# Secret Phase
Wow! You've defused the secret stage!
Congratulations! You've defused the bomb!						# Congrats!
</code></pre></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://Nopthon.github.io">Nopthon's trashcan</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if("05/29/2025"!=""){
    var startSite=new Date("05/29/2025");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","Nopthon/Nopthon.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
<script src='https://blog.meekdai.com/Gmeek/plugins/GmeekTOC.js'></script><script src='https://blog.meekdai.com/Gmeek/plugins/lightbox.js'></script><script src='https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js'></script>
<script>mermaid.initialize({startOnLoad: true, theme: 'default'});</script>

</html>
